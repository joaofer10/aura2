<!DOCTYPE html>
<html lang="pt-BR">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Achados e Perdidos ETEC</title>
    <link href="https://fonts.googleapis.com/css2?family=Montserrat:wght@400;600;700&family=Roboto:wght@400;500&display=swap" rel="stylesheet">
<style>
    /* Paleta de Cores Base (Opção A - Contraste e Vibrância) */
    :root {
        /* Cores do Modo Claro (ajustadas para suavidade e novo brilho) */
        --primary-color: #3f6ebc;   /* Um azul um pouco mais suave para destaque */
        --primary-bg: #d3dbe5;     /* Fundo principal: cinza mais escuro para a página toda */
        --medium-bg: #f1f1f1bb;     /* Fundo de cards/seções: cinza muito claro, para substituir o branco */
        --text-dark: #333333;     /* Texto escuro: permanece forte para leitura */
        --text-light: #666666;    /* Texto mais leve: para descrições ou secundário */
        --border-color: #c9d2de; /* Cor de bordas para separação suave */
        --button-primary-bg: #4a77cc; /* Botão primário: um azul que se destaca mas é agradável */
        --button-secondary-bg: #aebacd; /* Botão secundário: cinza azulado suave */

        /* Cores que podem ser usadas universalmente ou ajustadas por modo */
        --darker-blue: #1A3B8A; /* Azul escuro para detalhes, mantido para contraste */
        --red-danger: #F44336;
        --status-pending: #FFC107; /* Amarelo para pendente */
        --status-approved: #4CAF50; /* Verde para aprovado */
        --status-rejected: #F44336; /* Vermelho para rejeitado */
    }

    /* Modo Noturno (Contraste e Harmonia) */
    body.dark-mode {
        /* Cores do Modo Escuro (ajustadas para contraste e harmonia) */
        --primary-color: #7abaff;      /* Azul para destaque que brilha no escuro, mas não agride */
        --primary-bg: #121e28;        /* Fundo principal: cinza azulado muito escuro (para o corpo da página) */
        --medium-bg: #354e68;        /* Fundo de cards/seções: cinza azulado um pouco mais claro que o principal */
        --header-footer-dark-bg: #295f94; /* NOVO: Fundo mais escuro para cabeçalho e rodapé */
        --text-dark: #e0e0e0;        /* Texto escuro (agora claro): quase branco */
        --text-light: #b0b0b0;       /* Texto mais leve (agora claro): cinza claro */
        --border-color: #3b526b;    /* Cor de bordas para separação sutil */
        --button-primary-bg: #5f8fd4; /* Botão primário: um azul vibrante para destacar */
        --button-secondary-bg: #546a81; /* Botão secundário: cinza azulado médio */

        /* Adaptando as cores de dark-mode existentes para as novas variáveis */
        --dark-mode-bg: var(--primary-bg);
        --dark-mode-container-bg: var(--medium-bg);
        --dark-mode-header-footer: var(--header-footer-dark-bg); /* Usando a nova variável aqui */
        --dark-mode-text: var(--text-dark);
        --dark-mode-text-medium: var(--text-light);
        --dark-mode-border: var(--border-color);
        --dark-mode-input-bg: var(--medium-bg);
        --dark-mode-input-border: var(--border-color);
        --dark-mode-shadow: rgba(0, 0, 0, 0.5);
    }

    /* CSS Geral */
    body {
        font-family: 'Roboto', sans-serif;
        margin: 0;
        background-color: var(--primary-bg); /* Usando a variável */
        display: flex;
        flex-direction: column;
        min-height: 100vh;
        color: var(--text-dark); /* Usando a variável */
        transition: background-color 0.3s ease, color 0.3s ease;
    }

    .container {
        background-color: var(--medium-bg); /* Usando a variável */
        margin: 20px auto;
        padding: 25px;
        border-radius: 12px;
        box-shadow: 0 6px 15px rgba(0, 0, 0, 0.08);
        max-width: 900px;
        width: 95%;
        flex-grow: 1;
        display: flex;
        flex-direction: column;
        transition: background-color 0.3s ease, box-shadow 0.3s ease, border-radius 0.3s ease;
    }

    /* Cabeçalho */
    header {
        background-color: var(--primary-color); /* Usando a variável */
        color: #FFFFFF;
        padding: 15px 25px;
        display: flex;
        justify-content: space-between;
        align-items: center;
        border-bottom: 5px solid var(--darker-blue);
        box-shadow: 0 2px 8px rgba(0, 0, 0, 0.15);
        transition: background-color 0.3s ease, border-color 0.3s ease;
    }

    header h1 {
        margin: 0;
        font-size: 2em;
        font-family: 'Montserrat', sans-serif;
        font-weight: 700;
        letter-spacing: -0.5px;
    }

    .header-icons {
        display: flex;
        gap: 18px;
        align-items: center;
    }

    .header-icons .icon-btn {
        background: none;
        border: none;
        color: #FFFFFF;
        font-size: 1.6em;
        cursor: pointer;
        position: relative;
        transition: color 0.3s ease, transform 0.2s ease;
    }
    .header-icons .icon-btn:hover {
        transform: scale(1.1);
    }

    .header-icons .notification-count {
        position: absolute;
        top: -6px;
        right: -6px;
        background-color: var(--red-danger);
        color: white;
        border-radius: 50%;
        padding: 3px 7px;
        font-size: 0.75em;
        font-weight: bold;
        display: none;
        min-width: 20px;
        text-align: center;
        line-height: 1.2;
        box-shadow: 0 1px 3px rgba(0, 0, 0, 0.2);
    }

    /* Rodapé */
    footer {
        background-color: var(--primary-color); /* Usando a variável */
        color: #FFFFFF;
        text-align: center;
        padding: 12px 0;
        font-size: 0.9em;
        margin-top: auto;
        box-shadow: 0 -2px 8px rgba(0, 0, 0, 0.15);
        transition: background-color 0.3s ease;
    }

    /* Classes de exibição de telas */
    .screen {
        display: none;
        flex-direction: column;
        flex-grow: 1;
        padding: 20px 0;
    }

    .screen.active {
        display: flex;
    }

    /* Estilos gerais para botões */
    button {
        padding: 12px 22px;
        border: none;
        border-radius: 8px;
        cursor: pointer;
        font-size: 1.05em;
        font-weight: 600;
        transition: background-color 0.3s ease, transform 0.2s ease, box-shadow 0.2s ease;
        font-family: 'Montserrat', sans-serif;
        letter-spacing: 0.2px;
    }

    button.primary {
        background-color: var(--button-primary-bg); /* Usando a variável */
        color: white;
    }

    button.primary:hover {
        background-color: var(--darker-blue); /* Mantido para hover específico, pode ser ajustado */
        transform: translateY(-2px);
        box-shadow: 0 5px 12px rgba(0, 0, 0, 0.25);
    }

    button.secondary {
        background-color: var(--button-secondary-bg); /* Usando a variável */
        color: white;
    }

    button.secondary:hover {
        background-color: #8A8A8A; /* Pode ser ajustado para var(--button-secondary-bg) mais escuro */
        transform: translateY(-2px);
        box-shadow: 0 5px 12px rgba(0, 0, 0, 0.2);
    }

    button.danger {
        background-color: var(--red-danger);
        color: white;
    }
    button.danger:hover {
        background-color: #CD3328;
        transform: translateY(-2px);
        box-shadow: 0 5px 12px rgba(0, 0, 0, 0.25);
    }

    /* Estilos para campos de input */
    input[type="text"],
    input[type="password"],
    input[type="email"],
    textarea,
    select {
        width: calc(100% - 24px);
        padding: 12px;
        margin-bottom: 18px;
        border: 1px solid var(--border-color); /* Usando a variável */
        border-radius: 8px;
        box-sizing: border-box;
        font-size: 1em;
        background-color: var(--medium-bg); /* Usando a variável */
        color: var(--text-dark); /* Usando a variável */
        transition: border-color 0.3s ease, background-color 0.3s ease, box-shadow 0.3s ease;
    }
    input[type="text"]:focus,
    input[type="password"]:focus,
    input[type="email"]:focus,
    textarea:focus,
    select:focus {
        border-color: var(--primary-color); /* Usando a variável */
        outline: none;
        box-shadow: 0 0 0 3px rgba(45, 91, 255, 0.2); /* Sombra de foco mais suave, pode ser ajustada */
    }

    textarea {
        resize: vertical;
        min-height: 90px;
    }

    label {
        display: block;
        margin-bottom: 8px;
        font-weight: 500;
        color: var(--text-medium); /* Use text-light ou text-dark dependendo do contraste desejado */
        font-family: 'Roboto', sans-serif;
    }

    h2, h3 {
        font-family: 'Montserrat', sans-serif;
        color: var(--primary-color); /* Usando a variável */
        margin-bottom: 25px;
        font-weight: 700;
        letter-spacing: -0.5px;
    }
    h2 { font-size: 1.8em; }
    h3 { font-size: 1.4em; }

    /* Estilos para Cards de Item (Aluno e Secretaria) */
    .item-card, .proof-card, .my-proof-item {
        background-color: var(--medium-bg); /* Usando a variável */
        border-radius: 12px;
        padding: 20px;
        box-shadow: 0 4px 10px rgba(0,0,0,0.08);
        text-align: center;
        display: flex;
        flex-direction: column;
        justify-content: space-between;
        transition: background-color 0.3s ease, box-shadow 0.3s ease, border-radius 0.3s ease;
    }
    .item-card img, .proof-card img, .my-proof-item img {
        max-width: 100%;
        height: 160px;
        object-fit: cover;
        border-radius: 8px;
        margin-bottom: 15px;
        background-color: var(--border-color); /* Fundo para imagens transparentes */
        box-shadow: 0 2px 5px rgba(0,0,0,0.05);
    }
    .item-card h4, .proof-card p, .my-proof-item p {
        color: var(--text-dark); /* Usando a variável */
        margin-bottom: 8px;
        font-family: 'Montserrat', sans-serif;
        font-weight: 600;
    }
    .item-card p, .proof-card small, .my-proof-item small {
        font-size: 0.9em;
        color: var(--text-light); /* Usando a variável */
    }
    .item-card .primary, .proof-card .primary, .proof-card .danger, .my-proof-item .primary {
        margin-top: 20px;
        width: calc(100% - 20px);
        align-self: center;
    }
    .item-card .button-group, .my-proof-item .button-group {
        display: flex;
        justify-content: center;
        gap: 15px;
        margin-top: 20px;
    }

    /* Status colors for my-proof-item */
    .my-proof-item .status-tag {
        display: inline-block;
        padding: 6px 12px;
        border-radius: 6px;
        font-weight: bold;
        font-size: 0.85em;
        margin-top: 10px;
        color: white;
    }

    .my-proof-item .status-tag.pending {
        background-color: var(--status-pending);
        color: var(--text-dark); /* Texto escuro para contraste no amarelo */
    }
    .my-proof-item .status-tag.approved {
        background-color: var(--status-approved);
    }
    .my-proof-item .status-tag.rejected {
        background-color: var(--status-rejected);
    }

    /* Estilos para Filtros e Busca (Tela Aluno) */
    .filter-buttons {
        display: flex;
        flex-wrap: wrap;
        justify-content: center;
        gap: 12px;
        margin-bottom: 25px;
    }
    .filter-btn {
        background-color: var(--border-color); /* Cinza claro para filtros, usando variável */
        color: var(--text-dark);
        border: 1px solid var(--border-color);
        font-weight: 500;
    }
    .filter-btn.active {
        background-color: var(--primary-color); /* Usando a variável */
        color: white;
        border-color: var(--primary-color);
    }
    .filter-btn:hover:not(.active) {
        background-color: #D5D5D5; /* Pode ser ajustado para uma variante de border-color */
    }

    /* Estilos para Notificações */
    #notificationScreen #notificationMessages, #myProofsScreen #myProofsContainer {
        max-height: 400px;
        overflow-y: auto;
        padding-right: 15px;
        margin-bottom: 25px;
        margin-top: 20px;
    }
    .notification-item {
        background-color: var(--medium-bg); /* Usando a variável */
        border: 1px solid var(--border-color); /* Usando a variável */
        border-radius: 10px;
        padding: 18px;
        margin-bottom: 12px;
        box-shadow: 0 2px 6px rgba(0,0,0,0.06);
        transition: background-color 0.3s ease, box-shadow 0.3s ease;
        position: relative;
    }
    .notification-item.unread {
        background-color: rgba(var(--primary-color-rgb), 0.1); /* Usar RGB para transparência */
        border-left: 6px solid var(--primary-color);
        padding-left: 15px;
    }
    .notification-item .delete-notification {
        background: none;
        border: none;
        color: var(--red-danger);
        font-size: 0.95em;
        cursor: pointer;
        position: absolute;
        bottom: 8px;
        right: 15px;
        padding: 5px 8px;
        font-weight: 500;
        border-radius: 5px;
        transition: background-color 0.2s ease, color 0.2s ease;
    }
    .notification-item .delete-notification:hover {
        background-color: rgba(244, 67, 54, 0.1);
        color: #C0392B;
    }

    /* Mensagem Global de Feedback */
    #globalMessage {
        position: fixed;
        top: 50%;
        left: 50%;
        transform: translate(-50%, -50%);
        background-color: rgba(0, 0, 0, 0.9);
        color: white;
        padding: 30px 40px;
        border-radius: 12px;
        text-align: center;
        z-index: 1001;
        box-shadow: 0 8px 25px rgba(0,0,0,0.4);
        display: none;
        animation: fadeInScale 0.3s ease forwards;
    }
    @keyframes fadeInScale {
        from { opacity: 0; transform: translate(-50%, -50%) scale(0.9); }
        to { opacity: 1; transform: translate(-50%, -50%) scale(1); }
    }
    #globalMessage p {
        margin-bottom: 25px;
        font-size: 1.3em;
        font-weight: 500;
    }
    #globalMessage button {
        margin: 0 10px;
    }

    /* Estilos da Área da Secretaria (Tabs) */
    .secretary-tabs {
        display: flex;
        flex-wrap: wrap;
        justify-content: center;
        gap: 15px;
        margin-bottom: 30px;
    }
    .secretary-tabs button {
        flex-grow: 1;
        max-width: 220px;
    }

    /* Formulários internos da secretaria e login */
    #secretaryLogin form, #addNewItemForm form {
        max-width: 550px;
        margin: 35px auto;
        padding: 30px;
        background-color: var(--medium-bg); /* Usando a variável */
        border-radius: 12px;
        box-shadow: 0 5px 15px rgba(0,0,0,0.1);
        transition: background-color 0.3s ease, box-shadow 0.3s ease;
    }
    .category-checkboxes {
        display: flex;
        flex-wrap: wrap;
        gap: 18px;
        margin-bottom: 25px;
        margin-top: 8px;
    }
    .category-checkboxes label {
        display: flex;
        align-items: center;
        font-weight: normal;
        color: var(--text-light); /* Pode ser text-dark dependendo do contraste */
    }
    .category-checkboxes input[type="checkbox"] {
        margin-right: 8px;
        width: auto;
        margin-bottom: 0;
        transform: scale(1.1);
    }

    /* Pré-visualização da foto */
    #itemPhotoPreview {
        border: 1px solid var(--border-color); /* Usando a variável */
        border-radius: 8px;
        margin-top: 15px;
    }

    /* --- Modo Noturno Melhorado (Contraste e Harmonia) --- */
    body.dark-mode {
        background-color: var(--primary-bg); /* Usando a variável do dark mode */
        color: var(--text-dark); /* Usando a variável do dark mode (que é clara) */
    }
    .dark-mode .container {
        background-color: var(--medium-bg); /* Usando a variável do dark mode */
        box-shadow: 0 6px 15px var(--dark-mode-shadow);
    }
    /* NOVO: Aplica a cor mais escura para o cabeçalho e rodapé no dark mode */
    .dark-mode header,
    .dark-mode footer {
        background-color: var(--header-footer-dark-bg); /* Usa a nova variável mais escura */
        border-bottom-color: var(--darker-blue); /* Mantido, ajuste se precisar de outra cor */
    }
    .dark-mode .header-icons .icon-btn {
        color: var(--text-dark); /* Usando a variável do dark mode */
    }
    .dark-mode h2, .dark-mode h3 {
        color: var(--primary-color) !important; /* Usando a variável do dark mode */
    }
    .dark-mode label {
        color: var(--text-light); /* Usando a variável do dark mode */
    }
    .dark-mode input[type="text"],
    .dark-mode input[type="password"],
    .dark-mode input[type="email"],
    .dark-mode textarea,
    .dark-mode select {
        background-color: var(--medium-bg); /* Usando a variável do dark mode */
        color: var(--text-dark); /* Usando a variável do dark mode */
        border-color: var(--border-color); /* Usando a variável do dark mode */
    }
    .dark-mode input[type="text"]:focus,
    .dark-mode input[type="password"]:focus,
    .dark-mode input[type="email"]:focus,
    .dark-mode textarea:focus,
    .dark-mode select:focus {
        border-color: var(--primary-color); /* Usando a variável do dark mode */
        box-shadow: 0 0 0 3px rgba(122, 186, 255, 0.3); /* Ajustado para o novo primary-color do dark mode */
    }
    .dark-mode .filter-buttons button,
    .dark-mode button.secondary {
        background-color: var(--button-secondary-bg); /* Usando a variável do dark mode */
        color: var(--text-dark); /* Usando a variável do dark mode */
        border-color: var(--border-color); /* Usando a variável do dark mode */
    }
    .dark-mode .filter-buttons button:hover:not(.active),
    .dark-mode button.secondary:hover {
        background-color: #6A6A70; /* Pode ser ajustado para uma variante do dark mode secondary button */
    }
    .dark-mode .filter-btn.active,
    .dark-mode button.primary {
        background-color: var(--button-primary-bg); /* Usando a variável do dark mode */
        border-color: var(--button-primary-bg); /* Usando a variável do dark mode */
        color: white; /* Ou var(--primary-bg) se quiser mais contraste */
    }
    .dark-mode .filter-btn.active:hover,
    .dark-mode button.primary:hover {
        background-color: #4A8CF0; /* Pode ser ajustado para uma variante do dark mode primary button */
    }
    .dark-mode button.danger {
        background-color: #D65C50; /* Vermelho adaptado para dark mode */
    }
    .dark-mode button.danger:hover {
        background-color: #B24F44;
    }
    .dark-mode .item-card, .dark-mode .proof-card, .dark-mode .my-proof-item,
    .dark-mode #secretaryLogin form, .dark-mode #addNewItemForm form,
    .dark-mode #proofsList, .dark-mode #secretaryItemsList, .dark-mode #addNewItemForm {
        background-color: var(--medium-bg) !important; /* Usando a variável do dark mode */
        box-shadow: 0 5px 15px var(--dark-mode-shadow);
    }
    .dark-mode .item-card h4, .dark-mode .item-card p,
    .dark-mode .proof-card p, .dark-mode .proof-card strong,
    .dark-mode .notification-item p, .dark-mode .notification-item strong,
    .dark-mode .my-proof-item p, .dark-mode .my-proof-item strong {
        color: var(--text-dark) !important; /* Usando a variável do dark mode */
    }
    .dark-mode .item-card img, .dark-mode .proof-card img, .dark-mode .my-proof-item img {
        background-color: var(--border-color); /* Fundo mais escuro para imagens placeholder */
    }
    .dark-mode .notification-item, .dark-mode .my-proof-item {
        background-color: var(--medium-bg); /* Usando a variável do dark mode */
        border-color: var(--border-color); /* Usando a variável do dark mode */
    }
    .dark-mode .notification-item.unread {
        background-color: rgba(var(--primary-color-rgb), 0.1); /* Usar RGB para transparência */
        border-left-color: var(--primary-color); /* Usando a variável do dark mode */
    }
    .dark-mode .my-proof-item .status-tag.pending {
        background-color: var(--status-pending);
        color: var(--text-dark);
    }
    .dark-mode .my-proof-item .status-tag.approved {
        background-color: var(--status-approved);
    }
    .dark-mode .my-proof-item .status-tag.rejected {
        background-color: var(--status-rejected);
    }
    /* Estilo do cursor personalizado (mantido para caso queira retomar) */
    /* body {
        cursor: url('http://googleusercontent.com/image_generation_content/2'), auto;
    } */


    /* Media Queries para Responsividade Geral */
    @media (max-width: 768px) {
        header h1 {
            font-size: 1.6em;
        }
        .header-icons {
            gap: 12px;
        }
        .header-icons .icon-btn {
            font-size: 1.3em;
        }
        .container {
            margin: 10px auto;
            padding: 18px;
            width: 98%;
            border-radius: 10px;
        }
        .secretary-tabs button {
            max-width: unset;
            width: 100%;
            padding: 10px 15px;
            font-size: 0.95em;
        }
        #foundItemsList, #pendingProofsContainer, #registeredItemsContainer, #myProofsContainer {
            grid-template-columns: 1fr;
        }
        .item-card img, .proof-card img, .my-proof-item img {
            height: 140px;
        }
        #secretaryLogin form, #addNewItemForm form {
            padding: 20px;
            margin: 25px auto;
            border-radius: 10px;
        }
        h2 { font-size: 1.5em; margin-bottom: 20px; }
        h3 { font-size: 1.2em; margin-bottom: 20px; }
        button {
            padding: 10px 18px;
            font-size: 1em;
        }
        input[type="text"], input[type="password"], input[type="email"], textarea, select {
            padding: 10px;
            margin-bottom: 12px;
            border-radius: 6px;
        }
        label {
            margin-bottom: 6px;
            font-size: 0.95em;
        }
        .notification-item, .my-proof-item {
            padding: 15px;
            border-radius: 8px;
            margin-bottom: 10px;
        }
        #globalMessage {
            padding: 25px;
            border-radius: 12px;
        }
        #globalMessage p {
            font-size: 1.1em;
            margin-bottom: 20px;
        }
    }
</style>
</head>
<body>
    <header>
        <h1>Achados e perdidos</h1>
        <div class="header-icons">
            <button class="icon-btn" id="darkModeToggle" title="Modo Noturno">🌙</button>
            <button class="icon-btn" id="notificationBtn" title="Notificações">🔔<span class="notification-count" id="notificationCount">0</span></button>
            <button class="icon-btn" id="profileBtn" title="Acesso Secretaria">⚙️</button>
        </div>
    </header>

    <main class="container">
        <section id="studentHome" class="screen active">
            <h2 style="text-align: center;">itens encontrados na escola</h2>
            <input type="text" id="searchItem" placeholder="pesquisar por nome ou descrição do item...">

            <div class="filter-buttons">
                <button class="secondary filter-btn active" data-category="todos">todos</button>
                <button class="secondary filter-btn" data-category="material escolar">material escolar</button>
                <button class="secondary filter-btn" data-category="eletronicos">eletronicos</button>
                <button class="secondary filter-btn" data-category="roupas">roupas</button>
                <button class="secondary filter-btn" data-category="documentos">documentos</button>
                <button class="secondary filter-btn" data-category="outros">outros</button>
            </div>

            <div id="foundItemsList" style="display: grid; grid-template-columns: repeat(auto-fill, minmax(250px, 1fr)); gap: 20px;">
                </div>
            <p id="noFoundItemsMessage" style="text-align: center; color: #777; margin-top: 20px; display: none;">Nenhum item encontrado no momento.</p>

            <button class="secondary" id="viewMyProofsBtn" style="display: block; margin: 30px auto 0;">Minhas Solicitações de Posse</button>
        </section>

        <section id="proofOfOwnership" class="screen">
            <h2 style="text-align: center;">comprovar posse do item</h2>
            <p style="text-align: center; color: var(--text-medium); margin-bottom: 20px;">preencha as informações abaixo para confirmar posse</p>

            <form id="proofForm">
                <input type="hidden" id="proofItemId">
                <label for="studentName">seu nome completo <span style="color: var(--red-danger);">*</span></label>
                <input type="text" id="studentName" required>

                <label for="studentClass">sua turma <span style="color: var(--red-danger);">*</span></label>
                <input type="text" id="studentClass" required>

                <label for="lostLocation">onde você acha que perdeu <span style="color: var(--red-danger);">*</span></label>
                <input type="text" id="lostLocation" placeholder="ex: patio, sala de informatica..." required>

                <label for="itemCharacteristic">descreva um detalhe específico do item que NÃO está visível na foto:</label>
                <textarea id="itemCharacteristic" placeholder="ex: arranhão, sigla, etc."></textarea>

                <div style="display: flex; gap: 15px; justify-content: center; margin-top: 25px;">
                    <button type="submit" class="primary">comprovar posse</button>
                    <button type="button" class="secondary" onclick="showScreen('studentHome')">voltar para o inicio</button>
                </div>
            </form>
        </section>

        <section id="notificationScreen" class="screen">
            <h2 style="text-align: center;">Suas Notificações</h2>
            <p id="noNotificationsMessage" style="text-align: center; color: var(--text-light); margin-top: 20px; display: none;">Nenhuma notificação no momento.</p>
            <div id="notificationMessages" style="background-color: var(--medium-bg); padding: 25px; border-radius: 12px; margin-top: 25px; box-shadow: 0 4px 10px rgba(0,0,0,0.06);">
                </div>
            <button class="secondary" onclick="showScreen('studentHome')" style="display: block; margin: 30px auto 0;">Voltar ao Início</button>
        </section>

        <section id="myProofsScreen" class="screen">
            <h2 style="text-align: center;">Minhas Solicitações de Posse</h2>
            <p id="noMyProofsMessage" style="text-align: center; color: var(--text-light); grid-column: 1 / -1; margin-top: 20px; display: none;">Nenhuma solicitação de posse enviada ainda.</p>
            <div id="myProofsContainer" style="background-color: var(--medium-bg); padding: 25px; border-radius: 12px; margin-top: 25px; box-shadow: 0 4px 10px rgba(0,0,0,0.06); display: grid; grid-template-columns: repeat(auto-fill, minmax(280px, 1fr)); gap: 20px;">
                </div>
            <button class="secondary" onclick="showScreen('studentHome')" style="display: block; margin: 30px auto 0;">Voltar ao Início</button>
        </section>


        <section id="secretaryLogin" class="screen">
            <h2 style="text-align: center;">acesso da secretaria</h2>
            <form id="loginForm">
                <label for="secretaryEmail">e-mail:</label>
                <input type="email" id="secretaryEmail" required>

                <label for="secretaryPassword">senha:</label>
                <input type="password" id="secretaryPassword" required>

                <div style="display: flex; gap: 15px; justify-content: center; margin-top: 25px;">
                    <button type="submit" class="primary">login</button>
                    <button type="button" class="secondary" onclick="showScreen('studentHome')">voltar para o início</button>
                </div>
            </form>
        </section>

        <section id="secretaryDashboard" class="screen">
            <h2 style="text-align: center;">acesso da secretaria</h2>
            <div class="secretary-tabs">
                <button class="primary" id="viewProofsBtn">ver comprovações</button>
                <button class="primary" id="viewItemsBtn">ver itens cadastrados</button>
                <button class="primary" id="addNewItemBtn">cadastrar novo item</button>
            </div>

            <div id="proofsList" style="background-color: var(--medium-bg); padding: 25px; border-radius: 12px; margin-top: 25px; box-shadow: 0 4px 10px rgba(0,0,0,0.06);">
                <h3 style="text-align: center;">Comprovações de Posse Pendentes</h3>
                <div id="pendingProofsContainer" style="display: grid; grid-template-columns: repeat(auto-fill, minmax(300px, 1fr)); gap: 25px;">
                    </div>
                <p id="noProofsMessage" style="text-align: center; color: var(--text-light); display: none;">Nenhuma comprovação pendente no momento.</p>
            </div>

            <div id="secretaryItemsList" style="background-color: var(--medium-bg); padding: 25px; border-radius: 12px; margin-top: 25px; display: none; box-shadow: 0 4px 10px rgba(0,0,0,0.06);">
                <h3 style="text-align: center;">Itens Cadastrados</h3>
                <div id="registeredItemsContainer" style="display: grid; grid-template-columns: repeat(auto-fill, minmax(250px, 1fr)); gap: 25px;">
                    </div>
                <p id="noRegisteredItemsMessage" style="text-align: center; color: var(--text-light); display: none;">Nenhum item cadastrado ainda.</p>
            </div>

            <div id="addNewItemForm" style="background-color: var(--medium-bg); padding: 25px; border-radius: 12px; margin-top: 25px; display: none; box-shadow: 0 4px 10px rgba(0,0,0,0.06);">
                <h3 style="text-align: center;">Cadastrar Novo Item</h3>
                <form id="itemRegistrationForm">
                    <input type="hidden" id="editItemId">

                    <label for="itemName">nome do item: <span style="color: var(--red-danger);">*</span></label>
                    <input type="text" id="itemName" required>

                    <label for="itemDescription">descrição do item: <span style="color: var(--red-danger);">*</span></label>
                    <textarea id="itemDescription" required></textarea>

                    <label for="itemLocation">local onde foi encontrado: <span style="color: var(--red-danger);">*</span></label>
                    <input type="text" id="itemLocation" required>

                    <label style="margin-top: 15px;">selecione uma ou mais categorias do item: <span style="color: var(--red-danger);">*</span></label>
                    <div class="category-checkboxes">
                        <label><input type="checkbox" name="itemCategory" value="material escolar"> material escolar</label>
                        <label><input type="checkbox" name="itemCategory" value="eletronicos"> eletronicos</label>
                        <label><input type="checkbox" name="itemCategory" value="roupas"> roupas</label>
                        <label><input type="checkbox" name="itemCategory" value="documentos"> documentos</label>
                        <label><input type="checkbox" name="itemCategory" value="outros"> outros</label>
                    </div>

                    <label for="itemPhoto">foto do item (opcional):</label>
                    <input type="file" id="itemPhoto" accept="image/*" style="margin-bottom: 20px;">
                    <img id="itemPhotoPreview" src="#" alt="Pré-visualização da foto" style="max-width: 180px; max-height: 180px; display: none; margin-bottom: 20px; border-radius: 8px; box-shadow: 0 2px 5px rgba(0,0,0,0.08);">

                    <button type="submit" class="primary" id="addItemSubmitBtn">adicionar item</button>
                </form>
            </div>
        </section>

        <div id="globalMessage" style="display: none;">
            <p id="globalMessageText"></p>
            <div style="display: flex; justify-content: center; gap: 20px;">
                <button class="secondary" id="globalMessageUndoBtn" style="display: none;">Desfazer</button>
                <button class="primary" id="globalMessageContinueBtn">Continuar</button>
            </div>
        </div>
    </main>

    <footer>
        <p>Desenvolvido com ❤️ por Projeto Aura</p>
        <p>© 2025 ETEC Darcy - Todos os direitos reservados.</p>
    </footer>

    <script>
        // --- Funções de Utilidade para LocalStorage ---
        function getFromLocalStorage(key, defaultValue = []) {
            try {
                const data = localStorage.getItem(key);
                return data ? JSON.parse(data) : defaultValue;
            } catch (e) {
                console.error("Erro ao ler do localStorage para a chave", key, e);
                return defaultValue;
            }
        }

        function saveToLocalStorage(key, data) {
            try {
                localStorage.setItem(key, JSON.stringify(data));
            } catch (e) {
                console.error("Erro ao salvar no localStorage para a chave", key, e);
            }
        }

        // --- Variáveis Globais (Carregadas do localStorage) ---
        let itemsFound = getFromLocalStorage('itemsFound', []);
        let proofsOfOwnership = getFromLocalStorage('proofsOfOwnership', []);
        let notifications = getFromLocalStorage('notifications', []);

        // --- DADOS DUMMY PARA TESTE (Apenas para demonstração, remova em produção) ---
        if (itemsFound.length === 0) {
            itemsFound = [
                {
                    id: 'item_1678880000001',
                    name: 'Celular Samsung',
                    description: 'Celular preto, tela trincada no canto superior. Modelo antigo.',
                    location: 'Pátio Principal',
                    categories: ['eletronicos'],
                    photo: 'https://via.placeholder.com/180/2D5BFF/FFFFFF?text=Celular'
                },
                {
                    id: 'item_1678880000002',
                    name: 'Estojo de Lápis',
                    description: 'Estojo azul com zíper amarelo, contém 3 lápis e uma borracha.',
                    location: 'Sala 5',
                    categories: ['material escolar'],
                    photo: 'https://via.placeholder.com/180/F44336/FFFFFF?text=Estojo'
                },
                {
                    id: 'item_1678880000003',
                    name: 'Jaqueta Jeans',
                    description: 'Jaqueta jeans tamanho M, com um pequeno rasgo no ombro esquerdo.',
                    location: 'Quadra de Esportes',
                    categories: ['roupas'],
                    photo: 'https://via.placeholder.com/180/4CAF50/FFFFFF?text=Jaqueta'
                },
                {
                    id: 'item_1678880000004',
                    name: 'Carteira de Identidade',
                    description: 'RG em nome de Maria Silva, contém um chip colado na parte de trás.',
                    location: 'Biblioteca',
                    categories: ['documentos'],
                    photo: '' // Exemplo sem foto
                },
                {
                    id: 'item_1678880000005',
                    name: 'Chaveiro de Coruja',
                    description: 'Chaveiro de metal em formato de coruja, com duas chaves pequenas.',
                    location: 'Corredor Principal',
                    categories: ['outros'],
                    photo: 'https://via.placeholder.com/180/FFEB3B/000000?text=Chaveiro'
                }
            ];
            saveToLocalStorage('itemsFound', itemsFound);
        }

        if (notifications.length === 0) {
            addNotification({
                to: 'secretaria',
                title: 'Bem-vindo!',
                message: 'Bem-vindo ao sistema de Achados e Perdidos. Fique atento às notificações!',
                type: 'system',
                read: false,
                timestamp: new Date().toISOString()
            });
             addNotification({
                to: 'aluno',
                title: 'Item Encontrado!',
                message: 'Um livro de matemática foi encontrado na biblioteca. Verifique se é seu!',
                type: 'found_item_alert',
                read: false,
                timestamp: new Date(Date.now() - 3600 * 1000).toISOString() // 1 hora atrás
            });
        }
        // Dados dummy para comprovações, incluindo diferentes status
        if (proofsOfOwnership.length === 0) {
            proofsOfOwnership = [
                {
                    id: 'proof_1678880000010',
                    itemId: 'item_1678880000001',
                    itemName: 'Celular Samsung',
                    studentName: 'João Silva',
                    studentClass: '3º INFO B',
                    lostLocation: 'Pátio',
                    itemCharacteristic: 'Trincado no canto superior direito',
                    status: 'pendente',
                    timestamp: new Date().toISOString()
                },
                {
                    id: 'proof_1678880000011',
                    itemId: 'item_1678880000002',
                    itemName: 'Estojo de Lápis',
                    studentName: 'Maria Santos',
                    studentClass: '1º ADM A',
                    lostLocation: 'Sala 5',
                    itemCharacteristic: 'Contém um adesivo de estrela dourada por dentro',
                    status: 'aprovado',
                    timestamp: new Date(Date.now() - 86400 * 1000).toISOString() // 1 dia atrás
                },
                {
                    id: 'proof_1678880000012',
                    itemId: 'item_1678880000003',
                    itemName: 'Jaqueta Jeans',
                    studentName: 'Pedro Souza',
                    studentClass: '2º MEC C',
                    lostLocation: 'Quadra',
                    itemCharacteristic: 'Etiqueta com "P.S." bordado',
                    status: 'rejeitado',
                    timestamp: new Date(Date.now() - 2 * 86400 * 1000).toISOString() // 2 dias atrás
                }
            ];
            saveToLocalStorage('proofsOfOwnership', proofsOfOwnership);
        }
        // --- FIM DADOS DUMMY ---

        // --- Funções de Navegação e UI ---
        function showScreen(screenId) {
            document.querySelectorAll('.screen').forEach(screen => {
                screen.classList.remove('active');
            });
            document.getElementById(screenId).classList.add('active');
            // Se a tela de notificação for mostrada, renderiza seu conteúdo
            if (screenId === 'notificationScreen') {
                renderNotificationScreenContent();
            } else if (screenId === 'myProofsScreen') { // Renderiza minhas comprovações
                renderMyProofs();
            }
            // Resetar scroll para o topo ao mudar de tela
            window.scrollTo(0, 0);
        }

        // --- Sistema de Notificações ---
        function addNotification(notification) {
            // Garante que timestamp e read sejam definidos se não existirem
            notification.timestamp = notification.timestamp || new Date().toISOString();
            notification.read = typeof notification.read === 'boolean' ? notification.read : false;
            notifications.push(notification);
            saveToLocalStorage('notifications', notifications);
            updateNotificationCount();
        }

        function updateNotificationCount() {
            // Conta apenas notificações não lidas e que não sejam 'system' ou 'proof_response' da secretaria (assumindo que o aluno vê)
            // A lógica de "to" pode ser expandida para usuários reais, aqui é mais para ilustração
            const unreadNotifications = notifications.filter(n => !n.read && n.to !== 'secretaria'); // Alunos não veem notificações da secretaria
            const countElement = document.getElementById('notificationCount');
            if (unreadNotifications.length > 0) {
                countElement.textContent = unreadNotifications.length;
                countElement.style.display = 'block';
            } else {
                countElement.style.display = 'none';
            }
        }

        function renderNotificationScreenContent() { // Antiga showNotificationArea adaptada para a tela
            const notificationMessages = document.getElementById('notificationMessages');
            const noNotificationsMessageElement = document.getElementById('noNotificationsMessage'); // Obtenha a referência ANTES de limpar

            notificationMessages.innerHTML = ''; // Limpa antes de adicionar

            // Filtra as notificações para o "aluno" (ignorando as da secretaria para esta tela)
            const studentNotifications = notifications.filter(n => n.to !== 'secretaria').reverse(); // Exibe as mais recentes primeiro

            if (studentNotifications.length === 0) {
                if (noNotificationsMessageElement) {
                    noNotificationsMessageElement.style.display = 'block';
                }
            } else {
                if (noNotificationsMessageElement) {
                    noNotificationsMessageElement.style.display = 'none';
                }
                studentNotifications.forEach((n, index) => {
                    // Importante: o índice aqui é do array filtrado/invertido, não do array `notifications` original.
                    // Precisamos de um jeito de referenciar a notificação original para exclusão.
                    // Uma forma é usar o ID da notificação se tivéssemos um. Por enquanto, faremos uma busca.
                    const originalNotification = notifications.find(origN => origN.timestamp === n.timestamp && origN.title === n.title);
                    const originalIndex = originalNotification ? notifications.indexOf(originalNotification) : -1;

                    const notificationDiv = document.createElement('div');
                    notificationDiv.classList.add('notification-item');
                    if (!n.read) {
                        notificationDiv.classList.add('unread');
                    }
                    notificationDiv.innerHTML = `
                        <p><strong>${n.title}</strong></p>
                        <p>${n.message}</p>
                        <small>${new Date(n.timestamp).toLocaleString('pt-BR', { dateStyle: 'short', timeStyle: 'short' })}</small>
                        ${originalIndex !== -1 ? `<button class="delete-notification" data-original-index="${originalIndex}">Apagar</button>` : ''}
                    `;
                    notificationMessages.appendChild(notificationDiv);
                });
            }

            // Marcar todas as notificações VISÍVEIS como lidas ao abrir o painel
            studentNotifications.forEach(n => n.read = true);
            saveToLocalStorage('notifications', notifications); // Salva todas as notificações com o status atualizado
            updateNotificationCount(); // Atualiza o contador após marcar como lidas
        }


        document.getElementById('notificationMessages').addEventListener('click', (event) => {
            if (event.target.classList.contains('delete-notification')) {
                const originalIndex = parseInt(event.target.dataset.originalIndex); // Corrigido para originalIndex
                if (!isNaN(originalIndex) && originalIndex >= 0 && originalIndex < notifications.length) {
                    // Remover a notificação pelo índice original
                    notifications.splice(originalIndex, 1);
                    saveToLocalStorage('notifications', notifications);
                    renderNotificationScreenContent(); // Recarrega a lista de notificações na tela
                }
            }
        });

        // --- Renderização de Minhas Comprovações de Posse (Aluno) ---
        function renderMyProofs() {
            const container = document.getElementById('myProofsContainer');
            const noMyProofsMessageElement = document.getElementById('noMyProofsMessage'); // Obtenha a referência ANTES de limpar

            container.innerHTML = '';
            // Em um sistema real com login, filtraríamos por ID de aluno
            // Por enquanto, exibiremos todas as comprovações para demonstração
            const studentProofs = proofsOfOwnership.slice().reverse(); // Copia e inverte para mostrar as mais recentes primeiro

            if (studentProofs.length === 0) {
                if (noMyProofsMessageElement) {
                    noMyProofsMessageElement.style.display = 'block';
                }
            } else {
                if (noMyProofsMessageElement) {
                    noMyProofsMessageElement.style.display = 'none';
                }
                studentProofs.forEach(proof => {
                    const itemAssociated = itemsFound.find(item => item.id === proof.itemId);
                    const proofItem = document.createElement('div');
                    proofItem.classList.add('my-proof-item');

                    let statusClass = '';
                    let statusText = '';
                    switch (proof.status) {
                        case 'pendente':
                            statusClass = 'pending';
                            statusText = 'Pendente';
                            break;
                        case 'aprovado':
                            statusClass = 'approved';
                            statusText = 'Aprovado';
                            break;
                        case 'rejeitado':
                            statusClass = 'rejected';
                            statusText = 'Rejeitado';
                            break;
                    }

                    proofItem.innerHTML = `
                        ${itemAssociated && itemAssociated.photo ? `<img src="${itemAssociated.photo}" alt="${itemAssociated.name}">` : `<div style="width: 100%; height: 160px; background-color: #ccc; border-radius: 8px; display: flex; justify-content: center; align-items: center; color: #666; margin-bottom: 15px; font-size: 0.9em;">Item sem Imagem ou não encontrado</div>`}
                        <p><strong>Item:</strong> ${proof.itemName}</p>
                        <p><strong>Sua Turma:</strong> ${proof.studentClass}</p>
                        <p><strong>Local Perdido:</strong> ${proof.lostLocation}</p>
                        <p><strong>Status:</strong> <span class="status-tag ${statusClass}">${statusText}</span></p>
                        <small>Enviado em: ${new Date(proof.timestamp).toLocaleString('pt-BR', { dateStyle: 'short', timeStyle: 'short' })}</small>
                    `;
                    container.appendChild(proofItem);
                });
            }
        }


        // --- Mensagem Global de Feedback (com Desfazer/Continuar) ---
        function showGlobalMessage(message, showUndo = false, undoCallback = null, continueCallback = null) {
            const globalMessage = document.getElementById('globalMessage');
            document.getElementById('globalMessageText').textContent = message;
            const undoBtn = document.getElementById('globalMessageUndoBtn');
            const continueBtn = document.getElementById('globalMessageContinueBtn');

            if (showUndo && undoCallback) {
                undoBtn.style.display = 'inline-block';
                // Remove listeners antigos antes de adicionar novos
                undoBtn.onclick = null;
                undoBtn.onclick = () => {
                    undoCallback();
                    globalMessage.style.display = 'none';
                };
            } else {
                undoBtn.style.display = 'none';
            }

            // Remove listeners antigos antes de adicionar novos
            continueBtn.onclick = null;
            continueBtn.onclick = () => {
                if (continueCallback) continueCallback();
                globalMessage.style.display = 'none';
            };

            globalMessage.style.display = 'flex'; // Usar flex para centralizar conteúdo
        }

        // --- Event Listeners Globais ---
        document.addEventListener('DOMContentLoaded', () => {
            updateNotificationCount();
            renderFoundItems(); // Carrega os itens na tela inicial do aluno

            document.getElementById('notificationBtn').addEventListener('click', () => {
                showScreen('notificationScreen'); // Leva para a nova tela de notificações
            });
            document.getElementById('profileBtn').addEventListener('click', () => {
                showScreen('secretaryLogin');
            });
            document.getElementById('viewMyProofsBtn').addEventListener('click', () => { // Novo botão para minhas comprovações
                showScreen('myProofsScreen');
            });


            // Modo noturno
            document.getElementById('darkModeToggle').addEventListener('click', () => {
                document.body.classList.toggle('dark-mode');
                // Salvar preferência no localStorage
                if (document.body.classList.contains('dark-mode')) {
                    localStorage.setItem('darkMode', 'enabled');
                } else {
                    localStorage.setItem('darkMode', 'disabled');
                }
            });

            // Carregar preferência de dark mode ao iniciar
            if (localStorage.getItem('darkMode') === 'enabled') {
                document.body.classList.add('dark-mode');
            }
        });

        // --- Funções da Tela Inicial do Aluno ---
        function renderFoundItems(filter = 'todos', searchTerm = '') {
            const container = document.getElementById('foundItemsList');
            container.innerHTML = '';
            let filteredItems = itemsFound;

            if (filter !== 'todos') {
                filteredItems = filteredItems.filter(item => item.categories.includes(filter));
            }

            if (searchTerm) {
                const lowerCaseSearch = searchTerm.toLowerCase();
                filteredItems = filteredItems.filter(item =>
                    item.name.toLowerCase().includes(lowerCaseSearch) ||
                    item.description.toLowerCase().includes(lowerCaseSearch) ||
                    item.location.toLowerCase().includes(lowerCaseSearch) ||
                    item.categories.some(cat => cat.toLowerCase().includes(lowerCaseSearch))
                );
            }

            if (filteredItems.length === 0) {
                document.getElementById('noFoundItemsMessage').style.display = 'block';
                return;
            } else {
                document.getElementById('noFoundItemsMessage').style.display = 'none';
            }

            filteredItems.forEach(item => {
                const itemCard = document.createElement('div');
                itemCard.classList.add('item-card');
                itemCard.innerHTML = `
                    ${item.photo ? `<img src="${item.photo}" alt="${item.name}">` : `<div style="width: 100%; height: 160px; background-color: #ccc; border-radius: 8px; display: flex; justify-content: center; align-items: center; color: #666; margin-bottom: 15px;">Sem Imagem</div>`}
                    <h4>${item.name}</h4>
                    <p style="font-size: 0.9em; color: var(--text-medium);">${item.description}</p>
                    <p style="font-size: 0.8em; color: var(--text-light);">Local: ${item.location}</p>
                    <p style="font-size: 0.8em; color: var(--text-light);">Categoria: ${item.categories.join(', ')}</p>
                    <button class="primary claim-item-btn" data-item-id="${item.id}">Perdi este item!</button>
                `;
                container.appendChild(itemCard);
            });

            document.querySelectorAll('.claim-item-btn').forEach(button => {
                button.addEventListener('click', (event) => {
                    const itemId = event.target.dataset.itemId;
                    document.getElementById('proofItemId').value = itemId;
                    document.getElementById('proofForm').reset(); // Limpa form ao abrir
                    showScreen('proofOfOwnership');
                });
            });
        }

        // Filtro de itens na tela do aluno
        document.querySelectorAll('.filter-btn').forEach(button => {
            button.addEventListener('click', (event) => {
                document.querySelectorAll('.filter-btn').forEach(btn => btn.classList.remove('active'));
                event.target.classList.add('active');
                renderFoundItems(event.target.dataset.category, document.getElementById('searchItem').value);
            });
        });

        // Busca de itens na tela do aluno
        document.getElementById('searchItem').addEventListener('input', (event) => {
            const activeFilter = document.querySelector('.filter-btn.active').dataset.category;
            renderFoundItems(activeFilter, event.target.value);
        });

        // --- Formulário de Comprovação de Posse ---
        document.getElementById('proofForm').addEventListener('submit', (event) => {
            event.preventDefault();
            const itemId = document.getElementById('proofItemId').value;
            const item = itemsFound.find(i => i.id === itemId);

            if (!item) {
                alert('Erro: Item não encontrado para comprovação.');
                return;
            }

            const proof = {
                id: 'proof_' + Date.now(),
                itemId: itemId,
                itemName: item.name,
                studentName: document.getElementById('studentName').value,
                studentClass: document.getElementById('studentClass').value,
                lostLocation: document.getElementById('lostLocation').value,
                itemCharacteristic: document.getElementById('itemCharacteristic').value,
                status: 'pendente', // pendente, aprovado, rejeitado
                timestamp: new Date().toISOString()
            };
            proofsOfOwnership.push(proof);
            saveToLocalStorage('proofsOfOwnership', proofsOfOwnership);

            // Notificação para a secretaria
            addNotification({
                to: 'secretaria',
                title: 'Nova Comprovação de Posse',
                message: `O aluno(a) ${proof.studentName} da turma ${proof.studentClass} enviou uma comprovação para o item: "${item.name}".`,
                type: 'new_proof',
                read: false,
                timestamp: new Date().toISOString()
            });

            showGlobalMessage('Enviamos uma notificação para a secretaria. Aguarde a sua resposta.', false, null, () => {
                showScreen('studentHome');
                document.getElementById('proofForm').reset();
            });
        });

        // --- Login da Secretaria ---
        const SECRETARY_EMAIL = 'secretaria@etec.com'; // Credenciais simples para demonstração
        const SECRETARY_PASSWORD = 'senha123';

        document.getElementById('loginForm').addEventListener('submit', (event) => {
            event.preventDefault();
            const email = document.getElementById('secretaryEmail').value;
            const password = document.getElementById('secretaryPassword').value;

            if (email === SECRETARY_EMAIL && password === SECRETARY_PASSWORD) {
                alert('Login bem-sucedido!');
                showScreen('secretaryDashboard');
                showSecretarySubTab('proofsList'); // Exibe as comprovações por padrão
            } else {
                alert('Email ou senha incorretos.');
            }
        });

        // --- Funções da Área da Secretaria ---
        function showSecretarySubTab(tabId) {
            // Esconde todas as sub-abas
            document.getElementById('proofsList').style.display = 'none';
            document.getElementById('secretaryItemsList').style.display = 'none';
            document.getElementById('addNewItemForm').style.display = 'none';

            // Mostra a sub-aba selecionada
            document.getElementById(tabId).style.display = 'block';

            // Renderiza o conteúdo da aba
            if (tabId === 'proofsList') {
                renderProofsOfOwnership();
            } else if (tabId === 'secretaryItemsList') {
                renderSecretaryItems();
            } else if (tabId === 'addNewItemForm') {
                document.getElementById('itemRegistrationForm').reset(); // Limpa o formulário para novo item
                document.getElementById('itemPhotoPreview').src = '#';
                document.getElementById('itemPhotoPreview').style.display = 'none';
                document.getElementById('addItemSubmitBtn').textContent = 'adicionar item';
                document.getElementById('editItemId').value = ''; // Limpa ID para garantir novo cadastro
                document.querySelectorAll('input[name="itemCategory"]').forEach(cb => cb.checked = false); // Desmarca categorias
            }
        }

        document.getElementById('viewProofsBtn').addEventListener('click', () => showSecretarySubTab('proofsList'));
        document.getElementById('viewItemsBtn').addEventListener('click', () => showSecretarySubTab('secretaryItemsList'));
        document.getElementById('addNewItemBtn').addEventListener('click', () => showSecretarySubTab('addNewItemForm'));

        // --- Renderização de Comprovações de Posse (Secretaria) ---
        function renderProofsOfOwnership() {
            const container = document.getElementById('pendingProofsContainer');
            container.innerHTML = '';
            const pendingProofs = proofsOfOwnership.filter(proof => proof.status === 'pendente');

            if (pendingProofs.length === 0) {
                document.getElementById('noProofsMessage').style.display = 'block';
                return;
            } else {
                document.getElementById('noProofsMessage').style.display = 'none';
            }

            pendingProofs.forEach(proof => {
                const itemAssociated = itemsFound.find(item => item.id === proof.itemId);
                const proofCard = document.createElement('div');
                proofCard.classList.add('proof-card');
                proofCard.innerHTML = `
                    ${itemAssociated && itemAssociated.photo ? `<img src="${itemAssociated.photo}" alt="${itemAssociated.name}">` : `<div style="width: 100%; height: 160px; background-color: #ccc; border-radius: 8px; display: flex; justify-content: center; align-items: center; color: #666; margin-bottom: 15px; font-size: 0.9em;">Item sem Imagem ou não encontrado</div>`}
                    <p><strong>Item:</strong> ${proof.itemName}</p>
                    <p><strong>Aluno:</strong> ${proof.studentName}</p>
                    <p><strong>Turma:</strong> ${proof.studentClass}</p>
                    <p><strong>Local Perdido:</strong> ${proof.lostLocation}</p>
                    <p><strong>Característica:</strong> ${proof.itemCharacteristic || 'N/A'}</p>
                    <div class="button-group">
                        <button class="primary approve-proof-btn" data-proof-id="${proof.id}">Aprovar</button>
                        <button class="danger reject-proof-btn" data-proof-id="${proof.id}">Rejeitar</button>
                    </div>
                `;
                container.appendChild(proofCard);
            });

            document.querySelectorAll('.approve-proof-btn').forEach(btn => {
                btn.addEventListener('click', (event) => handleProofAction(event.target.dataset.proofId, 'aprovado'));
            });
            document.querySelectorAll('.reject-proof-btn').forEach(btn => {
                btn.addEventListener('click', (event) => handleProofAction(event.target.dataset.proofId, 'rejeitado'));
            });
        }

        function handleProofAction(proofId, status) {
            const proofIndex = proofsOfOwnership.findIndex(p => p.id === proofId);
            if (proofIndex > -1) {
                const proof = proofsOfOwnership[proofIndex];
                proof.status = status;
                saveToLocalStorage('proofsOfOwnership', proofsOfOwnership);

                // Notificação para o aluno (simulada)
                addNotification({
                    to: 'aluno', // Idealmente seria um ID de aluno para notificação específica
                    title: `Sua Comprovação do item "${proof.itemName}" foi ${status === 'aprovado' ? 'Aprovada' : 'Rejeitada'}`,
                    message: `A secretaria revisou sua solicitação para o item "${proof.itemName}". Status: ${status.toUpperCase()}.`,
                    type: 'proof_response',
                    read: false,
                    timestamp: new Date().toISOString()
                });

                showGlobalMessage(`Comprovação ${status} com sucesso!`, false, null, () => {
                    renderProofsOfOwnership(); // Atualiza a lista de comprovações
                });
            }
        }

        // --- Renderização de Itens Cadastrados (Secretaria) ---
        function renderSecretaryItems() {
            const container = document.getElementById('registeredItemsContainer');
            container.innerHTML = '';

            if (itemsFound.length === 0) {
                document.getElementById('noRegisteredItemsMessage').style.display = 'block';
                return;
            } else {
                document.getElementById('noRegisteredItemsMessage').style.display = 'none';
            }

            itemsFound.forEach(item => {
                const itemCard = document.createElement('div');
                itemCard.classList.add('item-card');
                itemCard.innerHTML = `
                    ${item.photo ? `<img src="${item.photo}" alt="${item.name}">` : `<div style="width: 100%; height: 160px; background-color: #ccc; border-radius: 8px; display: flex; justify-content: center; align-items: center; color: #666; margin-bottom: 15px;">Sem Imagem</div>`}
                    <h4>${item.name}</h4>
                    <p style="font-size: 0.9em; color: var(--text-medium);">${item.description}</p>
                    <p style="font-size: 0.8em; color: var(--text-light);">Local: ${item.location}</p>
                    <p style="font-size: 0.8em; color: var(--text-light);">Categoria: ${item.categories.join(', ')}</p>
                    <div class="button-group">
                        <button class="primary edit-item-btn" data-item-id="${item.id}">Editar</button>
                        <button class="danger delete-item-btn" data-item-id="${item.id}">Excluir</button>
                    </div>
                `;
                container.appendChild(itemCard);
            });

            document.querySelectorAll('.edit-item-btn').forEach(btn => {
                btn.addEventListener('click', (event) => editItem(event.target.dataset.itemId));
            });
            document.querySelectorAll('.delete-item-btn').forEach(btn => {
                btn.addEventListener('click', (event) => deleteItem(event.target.dataset.itemId));
            });
        }

        // --- Cadastro/Edição de Item (Secretaria) ---
        document.getElementById('itemRegistrationForm').addEventListener('submit', (event) => {
            event.preventDefault();
            const itemId = document.getElementById('editItemId').value;
            const name = document.getElementById('itemName').value;
            const description = document.getElementById('itemDescription').value;
            const location = document.getElementById('itemLocation').value;
            const categories = Array.from(document.querySelectorAll('input[name="itemCategory"]:checked')).map(cb => cb.value);
            const photoFile = document.getElementById('itemPhoto').files[0];
            let photoURL = document.getElementById('itemPhotoPreview').src; // Pega URL existente

            if (categories.length === 0) {
                alert('Selecione ao menos uma categoria para o item.');
                return;
            }

            const saveItem = (url) => {
                if (itemId) { // Edição de item existente
                    const itemIndex = itemsFound.findIndex(item => item.id === itemId);
                    if (itemIndex > -1) {
                        itemsFound[itemIndex] = { ...itemsFound[itemIndex],
                            name,
                            description,
                            location,
                            categories,
                            photo: url || photoURL || '' // Prioriza nova URL, senão a existente, senão vazia
                        };
                        saveToLocalStorage('itemsFound', itemsFound);
                        showGlobalMessage('Item editado com sucesso!', false, null, () => {
                            showSecretarySubTab('secretaryItemsList');
                            renderFoundItems();
                        });
                    }
                } else { // Novo item
                    const newItem = {
                        id: 'item_' + Date.now(),
                        name,
                        description,
                        location,
                        categories,
                        photo: url || ''
                    };
                    itemsFound.push(newItem);
                    saveToLocalStorage('itemsFound', itemsFound);
                    addNotification({
                        to: 'aluno',
                        title: `Novo item encontrado: ${newItem.name}`,
                        message: `Um ${newItem.name} foi encontrado e adicionado à lista de achados e perdidos. Verifique se é seu!`,
                        type: 'new_item_found',
                        read: false,
                        timestamp: new Date().toISOString()
                    });
                    showGlobalMessage('Item adicionado com sucesso!', true, () => {
                        // Undo add: remove o último item adicionado
                        itemsFound.pop();
                        saveToLocalStorage('itemsFound', itemsFound);
                        renderFoundItems();
                        renderSecretaryItems();
                    }, () => {
                        showSecretarySubTab('secretaryItemsList');
                        renderFoundItems();
                    });
                }
                document.getElementById('itemRegistrationForm').reset();
                document.getElementById('itemPhotoPreview').src = '#'; // Resetar preview
                document.getElementById('itemPhotoPreview').style.display = 'none';
                document.getElementById('addItemSubmitBtn').textContent = 'adicionar item'; // Resetar texto do botão
                document.getElementById('editItemId').value = ''; // Limpar ID de edição
            };

            if (photoFile) {
                const reader = new FileReader();
                reader.onload = (e) => {
                    saveItem(e.target.result); // Base64 da imagem
                };
                reader.readAsDataURL(photoFile);
            } else {
                // Se a foto atual é uma base64, mantém. Se for placeholder ou vazia, reseta.
                saveItem(photoURL && photoURL.startsWith('data:') ? photoURL : '');
            }
        });

        // Pré-visualização da foto
        document.getElementById('itemPhoto').addEventListener('change', (event) => {
            const preview = document.getElementById('itemPhotoPreview');
            const file = event.target.files[0];
            if (file) {
                const reader = new FileReader();
                reader.onload = (e) => {
                    preview.src = e.target.result;
                    preview.style.display = 'block';
                };
                reader.readAsDataURL(file);
            } else {
                preview.src = '#';
                preview.style.display = 'none';
            }
        });

        function editItem(id) {
            const item = itemsFound.find(i => i.id === id);
            if (item) {
                showSecretarySubTab('addNewItemForm');
                document.getElementById('editItemId').value = item.id;
                document.getElementById('itemName').value = item.name;
                document.getElementById('itemDescription').value = item.description;
                document.getElementById('itemLocation').value = item.location;

                document.querySelectorAll('input[name="itemCategory"]').forEach(cb => {
                    cb.checked = item.categories.includes(cb.value);
                });

                if (item.photo) {
                    document.getElementById('itemPhotoPreview').src = item.photo;
                    document.getElementById('itemPhotoPreview').style.display = 'block';
                } else {
                    document.getElementById('itemPhotoPreview').src = '#';
                    document.getElementById('itemPhotoPreview').style.display = 'none';
                }

                document.getElementById('addItemSubmitBtn').textContent = 'Salvar Alterações';
            }
        }

        function deleteItem(id) {
            const itemIndex = itemsFound.findIndex(item => item.id === id);
            if (itemIndex > -1) {
                const deletedItem = itemsFound.splice(itemIndex, 1)[0];
                saveToLocalStorage('itemsFound', itemsFound);

                showGlobalMessage(`Item "${deletedItem.name}" excluído com sucesso!`, true, () => {
                    // Undo delete
                    itemsFound.splice(itemIndex, 0, deletedItem);
                    saveToLocalStorage('itemsFound', itemsFound);
                    renderSecretaryItems();
                    renderFoundItems();
                }, () => {
                    renderSecretaryItems();
                    renderFoundItems();
                });
            }
        }
    </script>
</body>
</html>