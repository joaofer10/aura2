<!DOCTYPE html>
<html lang="pt-BR">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Achados e Perdidos Escolar</title>
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.0.0-beta3/css/all.min.css">
    <link href="https://fonts.googleapis.com/css2?family=Poppins:wght@300;400;600&display=swap" rel="stylesheet">

    <style>
        /* Vari√°veis CSS - Paleta de Cores ETEC Dacy Inspired */
        :root {
            --primary-color: #004080; /* Azul Marinho Profundo (Principal) */
            --secondary-color: #17a2b8; /* Ciano/Azul Vibrante (Destaque) */
            --background-color: #f8f9fa; /* Cinza claro suave (Fundo da P√°gina) */
            --card-background: #ffffff; /* Branco (Fundo dos Cards/Containers) */
            --text-color: #343a40; /* Cinza Escuro (Texto Principal) */
            --border-color: #dee2e6; /* Cinza para Bordas */
            --hover-color: #0056b3; /* Azul mais escuro para hover */
            --danger-color: #dc3545; /* Vermelho para a√ß√µes perigosas */
            --success-color: #28a745; /* Verde para sucesso */
            --info-color: #6c757d; /* Azul acinzentado para informa√ß√µes */
            --light-grey: #e9ecef; /* Um cinza muito leve para fundos de input/toggle */
            --notification-badge-color: #ff0000; /* Vermelho vibrante para notifica√ß√µes */
        }

        /* Reset B√°sico e Estilos Globais */
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
        }

        body {
            font-family: 'Poppins', sans-serif;
            line-height: 1.6;
            color: var(--text-color);
            background-color: var(--background-color);
            display: flex;
            flex-direction: column;
            min-height: 100vh;
            padding-top: 150px; /* AJUSTADO: Espa√ßo para o header fixo e MAIOR */
        }

        /* Header */
        header {
            background-color: var(--primary-color);
            color: white;
            padding: 1rem 1.5rem;
            text-align: center;
            box-shadow: 0 2px 5px rgba(0, 0, 0, 0.1);
            position: fixed;
            width: 100%;
            top: 0;
            left: 0;
            z-index: 1000;
            height: 150px; /* NOVO: Altura fixa para o cabe√ßalho */
            display: flex; /* Para centralizar conte√∫do verticalmente */
            align-items: center; /* Centraliza verticalmente */
        }

        .header-content {
            display: flex;
            justify-content: space-between;
            align-items: center;
            max-width: 960px;
            margin: 0 auto;
            position: relative;
            width: 100%; /* Ocupa a largura total do header */
        }

        .main-title-area {
            display: flex;
            align-items: center;
            gap: 10px;
            position: absolute;
            left: 50%;
            transform: translateX(-50%);
        }

        header h1 {
            margin: 0;
            font-weight: 600;
            font-size: 2.5rem;
            white-space: nowrap;
        }

        .header-main-logo {
            height: 70px; /* Ajustado para acompanhar o novo tamanho do cabe√ßalho */
            width: auto;
            object-fit: contain;
        }

        /* Container para os √≠cones √† direita */
        .header-icons-right {
            display: flex;
            gap: 15px; /* Espa√ßo entre os √≠cones */
            position: absolute;
            right: 20px; /* AJUSTADO: um pouco mais para o canto, mas com margem */
            top: 50%; /* Alinha verticalmente no centro do header */
            transform: translateY(-50%); /* Ajuste fino para o centro */
        }

        .secretary-icon-btn,
        .notification-icon-btn {
            background: none;
            border: none;
            color: white;
            font-size: 2rem;
            cursor: pointer;
            transition: color 0.3s ease; /* AJUSTADO: Apenas transi√ß√£o de cor */
            padding: 0.5rem;
            position: relative;
        }

        .secretary-icon-btn:hover,
        .notification-icon-btn:hover {
            color: var(--secondary-color);
        }

        /* Main Content */
        main {
            flex-grow: 1;
            padding: 2rem 1rem;
            max-width: 900px;
            margin: 2rem auto;
            background-color: var(--card-background);
            border-radius: 8px;
            box-shadow: 0 4px 15px rgba(0, 0, 0, 0.08);
        }

        /* Se√ß√µes Escondidas/Ativas */
        section {
            display: none;
            padding: 1.5rem;
        }

        section.active {
            display: block;
        }

        section.hidden {
            display: none !important; /* For√ßa ocultar */
        }

        /* Estilo para T√≠tulos das Se√ß√µes */
        h2 {
            color: var(--primary-color);
            text-align: center;
            margin-bottom: 1.5rem;
            font-weight: 600;
            font-size: 2rem;
        }

        .section-description {
            text-align: center;
            color: var(--info-color);
            margin-bottom: 1.5rem;
            font-size: 1rem;
        }

        /* Cont√™iner de Autentica√ß√£o */
        .auth-container {
            max-width: 400px;
            margin: 0 auto;
            padding: 2rem;
            background-color: var(--card-background);
            border-radius: 8px;
            box-shadow: 0 2px 8px rgba(0, 0, 0, 0.1);
        }

        .auth-toggle {
            display: flex;
            margin-bottom: 1.5rem;
            border-radius: 5px;
            overflow: hidden;
            border: 1px solid var(--secondary-color);
        }

        .auth-toggle button {
            flex: 1;
            padding: 0.8rem 1rem;
            border: none;
            background-color: transparent;
            color: var(--secondary-color);
            font-size: 1rem;
            cursor: pointer;
            transition: background-color 0.3s ease, color 0.3s ease;
        }

        .auth-toggle button.active {
            background-color: var(--secondary-color);
            color: white;
            font-weight: 600;
        }

        .auth-form {
            display: none;
        }

        .auth-form.active {
            display: block;
        }

        /* Grupos de Input */
        .input-group {
            margin-bottom: 1rem;
        }

        .input-group label {
            display: block;
            margin-bottom: 0.5rem;
            font-weight: 400;
            color: var(--text-color);
        }

        .input-group input[type="email"],
        .input-group input[type="password"],
        .input-group input[type="text"],
        .input-group textarea,
        .input-group input[type="datetime-local"],
        .input-group input[type="file"],
        .input-group select, /* NOVO: Estilo para o select de categoria */
        .search-bar input[type="text"] {
            width: 100%;
            padding: 0.8rem;
            border: 1px solid var(--border-color);
            border-radius: 5px;
            font-size: 1rem;
            transition: border-color 0.3s ease, box-shadow 0.3s ease;
            background-color: var(--light-grey);
            color: var(--text-color);
        }

        .input-group input:focus,
        .input-group textarea:focus,
        .input-group select:focus, /* NOVO: Estilo para o select de categoria */
        .search-bar input:focus {
            border-color: var(--secondary-color);
            outline: none;
            box-shadow: 0 0 0 2px rgba(23, 162, 184, 0.2);
        }

        textarea {
            resize: vertical;
        }

        .input-hint {
            font-size: 0.85rem;
            color: var(--info-color);
            margin-top: 0.3rem;
        }

        /* Bot√µes */
        button[type="submit"],
        .dashboard-nav button,
        .secondary-btn,
        .claim-btn {
            display: block;
            width: 100%;
            padding: 0.8rem 1.2rem;
            background-color: var(--primary-color);
            color: white;
            border: none;
            border-radius: 5px;
            font-size: 1rem;
            cursor: pointer;
            transition: background-color 0.3s ease, transform 0.2s ease;
            margin-top: 1.5rem;
            font-weight: 600;
            letter-spacing: 0.5px;
        }

        button[type="submit"]:hover,
        .claim-btn:hover {
            background-color: var(--hover-color);
            transform: translateY(-2px);
        }

        .secondary-btn { /* Ajustes para o bot√£o "Voltar" */
            background-color: var(--info-color);
            margin-top: 1rem; /* Menos margem para n√£o ficar muito separado */
        }
        .secondary-btn:hover {
            background-color: #5a6268;
            transform: translateY(-2px);
        }

        .dashboard-nav {
            display: flex;
            flex-wrap: wrap;
            justify-content: center;
            gap: 1rem;
            margin-bottom: 2rem;
        }

        .dashboard-nav button {
            flex: 1;
            min-width: 180px;
            margin-top: 0;
            background-color: var(--primary-color);
            position: relative;
        }

        .dashboard-nav button:hover {
            background-color: var(--secondary-color);
        }

        .dashboard-nav button.logout {
            background-color: var(--danger-color);
        }

        .dashboard-nav button.logout:hover {
            background-color: #c82333;
        }

        /* Badge de Notifica√ß√£o */
        .notification-badge {
            position: absolute;
            top: -8px;
            right: -8px;
            background-color: var(--notification-badge-color);
            color: white;
            border-radius: 50%;
            padding: 2px 7px;
            font-size: 0.75rem;
            font-weight: bold;
            min-width: 20px;
            text-align: center;
            line-height: 1.2;
            box-shadow: 0 0 0 2px var(--card-background);
        }

        .notification-badge.hidden {
            display: none;
        }

        /* Mensagens de Feedback */
        .message {
            text-align: center;
            margin-top: 1rem;
            font-size: 0.9rem;
            padding: 0.5rem;
            border-radius: 4px;
            font-weight: 500;
        }

        .message.error {
            color: var(--danger-color);
            background-color: rgba(220, 53, 69, 0.1);
            border: 1px solid var(--danger-color);
        }

        .message.success {
            color: var(--success-color);
            background-color: rgba(40, 167, 69, 0.1);
            border: 1px solid var(--success-color);
        }

        .message.info {
            color: var(--info-color);
            background-color: rgba(108, 117, 125, 0.1);
            border: 1px solid var(--info-color);
        }

        /* Dashboard da Secretaria */
        .dashboard-content {
            display: none;
            padding: 1rem 0;
        }

        .dashboard-content.active-content {
            display: block;
        }

        /* Grid de Itens e Comprova√ß√µes */
        .items-grid {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(250px, 1fr));
            gap: 1.5rem;
            margin-top: 1.5rem;
        }

        .item-card {
            background-color: var(--card-background);
            border: 1px solid var(--border-color);
            border-radius: 8px;
            overflow: hidden;
            box-shadow: 0 2px 8px rgba(0, 0, 0, 0.05);
            display: flex;
            flex-direction: column;
            transition: transform 0.2s ease, box-shadow 0.2s ease;
        }

        .item-card:hover {
            transform: translateY(-5px);
            box-shadow: 0 6px 12px rgba(0, 0, 0, 0.1);
        }

        .item-card img {
            width: 100%;
            height: 180px;
            object-fit: contain; /* Mant√©m a propor√ß√£o e encaixa */
            background-color: var(--light-grey);
            border-bottom: 1px solid var(--border-color);
            padding: 5px; /* Adiciona um pequeno padding para respiro */
        }

        /* Estilo para √≠cone de item padr√£o */
        .item-card .item-placeholder-icon {
            width: 100%;
            height: 180px;
            background-color: var(--light-grey);
            color: var(--info-color);
            display: flex;
            justify-content: center;
            align-items: center;
            font-size: 4rem;
            border-bottom: 1px solid var(--border-color);
            padding: 5px;
        }

        .item-card-content {
            padding: 1rem;
            flex-grow: 1;
            display: flex;
            flex-direction: column;
        }

        .item-card h3 {
            margin-bottom: 0.5rem;
            color: var(--primary-color);
            font-size: 1.25rem;
            font-weight: 600;
        }

        .item-card p {
            font-size: 0.9rem;
            color: var(--text-color);
            margin-bottom: 0.5rem;
        }

        .item-card .item-meta {
            font-size: 0.8rem;
            color: var(--info-color);
            margin-top: auto;
            padding-top: 0.8rem;
            border-top: 1px dashed var(--border-color);
            margin-top: 1rem;
        }

        .item-card .item-actions {
            display: flex;
            gap: 0.5rem;
            margin-top: 1rem;
        }

        .item-card .item-actions button {
            flex: 1;
            padding: 0.6rem;
            font-size: 0.9rem;
            margin-top: 0;
        }

        .item-card .item-actions .edit-btn {
            background-color: var(--secondary-color);
        }

        .item-card .item-actions .edit-btn:hover {
            background-color: #118ba1;
        }

        .item-card .item-actions .delete-btn {
            background-color: var(--danger-color);
        }

        .item-card .item-actions .delete-btn:hover {
            background-color: #c82333;
        }

        /* Estilos para cards de comprova√ß√£o */
        .proof-card {
            background-color: var(--card-background);
            border: 1px solid var(--border-color);
            border-radius: 8px;
            box-shadow: 0 2px 8px rgba(0, 0, 0, 0.05);
            padding: 1.5rem;
            display: flex;
            flex-direction: column; /* Garante que os elementos se empilhem verticalmente */
            align-items: center; /* Centraliza o conte√∫do horizontalmente no card */
            text-align: center; /* Centraliza o texto */
            gap: 0.75rem;
        }

        .proof-card h3 {
            color: var(--primary-color);
            font-size: 1.2rem;
            margin-bottom: 0.5rem;
        }

        .proof-card p {
            font-size: 0.95rem;
            color: var(--text-color);
            margin-bottom: 0;
            text-align: left; /* Volta o texto dos par√°grafos para a esquerda */
            width: 100%; /* Garante que os par√°grafos ocupem a largura total */
        }

        .proof-card .proof-meta {
            font-size: 0.8rem;
            color: var(--info-color);
            margin-top: auto;
        }

        .proof-card .proof-actions {
            display: flex;
            gap: 0.5rem;
            margin-top: 1rem;
        }

        .proof-card .proof-actions button {
            flex: 1;
            padding: 0.6rem;
            font-size: 0.9rem;
            margin-top: 0;
        }

        .proof-card .proof-actions .approve-btn {
            background-color: var(--success-color);
        }
        .proof-card .proof-actions .approve-btn:hover {
            background-color: #218838;
        }

        .proof-card .proof-actions .reject-btn {
            background-color: var(--danger-color);
        }
        .proof-card .proof-actions .reject-btn:hover {
            background-color: #c82333;
        }

        /* Estilo para a miniatura do item dentro do card de comprova√ß√£o (NOVO) */
        .proof-item-thumbnail {
            width: 100px; /* Largura fixa */
            height: 100px; /* Altura fixa */
            object-fit: contain; /* Garante que a imagem se ajuste sem cortar */
            border: 1px solid var(--border-color);
            border-radius: 4px;
            margin: 0 auto 10px auto; /* Centraliza e adiciona margem inferior */
            display: block; /* Garante que ocupe sua pr√≥pria linha */
            background-color: var(--light-grey);
            padding: 5px; /* Pequeno padding para respiro */
        }

        /* Estilo para o placeholder de √≠cone no card de comprova√ß√£o (NOVO) */
        .proof-item-placeholder-icon {
            width: 100px;
            height: 100px;
            background-color: var(--light-grey);
            color: var(--info-color);
            display: flex;
            justify-content: center;
            align-items: center;
            font-size: 3rem; /* Tamanho do √≠cone */
            border: 1px solid var(--border-color);
            border-radius: 4px;
            margin: 0 auto 10px auto;
        }


        /* Pr√©-visualiza√ß√£o da Foto */
        .photo-preview {
            max-width: 100%;
            max-height: 200px;
            margin-top: 1rem;
            border: 1px dashed var(--border-color);
            border-radius: 5px;
            display: block;
            object-fit: contain; /* Garante que a imagem caiba sem cortar */
            background-color: var(--light-grey);
        }

        .photo-preview.hidden {
            display: none;
        }

        /* Visualiza√ß√£o para Alunos */
        .search-bar {
            margin-bottom: 1.5rem;
            display: flex; /* MODIFICADO: Para alinhar search e filter */
            gap: 10px; /* Espa√ßo entre os elementos de busca/filtro */
            flex-wrap: wrap; /* Permite quebrar linha em telas pequenas */
        }

        .search-bar input[type="text"] {
            flex-grow: 1; /* Permite que o input de busca cres√ßa */
        }

        /* NOVO: Estilos para os bot√µes de filtro */
        .filter-buttons {
            display: flex;
            flex-wrap: wrap; /* Permite quebrar linha em telas pequenas */
            justify-content: flex-start; /* Alinha √† esquerda na se√ß√£o do aluno */
            gap: 10px; /* Espa√ßo entre os bot√µes */
            margin-top: 1.5rem; /* Espa√ßo acima dos bot√µes de filtro */
            margin-bottom: 1.5rem; /* Espa√ßo abaixo dos bot√µes de filtro */
            width: 100%; /* Ocupa a largura total da barra de busca */
        }

        .filter-button {
            background-color: var(--card-background); /* Fundo branco ou cinza claro */
            color: var(--text-color); /* Texto escuro */
            border: 1px solid var(--border-color); /* Borda sutil */
            border-radius: 20px; /* Cantos arredondados, estilo 'pill' */
            padding: 0.6rem 1.2rem;
            font-size: 0.9rem;
            cursor: pointer;
            transition: all 0.3s ease;
            white-space: nowrap; /* Impede que o texto quebre */
        }

        .filter-button:hover {
            background-color: var(--light-grey); /* Leve escurecimento no hover */
            border-color: var(--secondary-color); /* Borda destaca no hover */
        }

        .filter-button.active {
            background-color: var(--secondary-color); /* Fundo vibrante para ativo */
            color: white; /* Texto branco */
            border-color: var(--secondary-color);
            font-weight: 600; /* Negrito para ativo */
            box-shadow: 0 2px 5px rgba(23, 162, 184, 0.2); /* Sombra para destaque */
        }

        /* Estilo para o bot√£o "Todos" ou "Resetar Filtro" */
        .filter-button.all-items-btn {
            background-color: var(--info-color); /* Cor diferente para "Todos" */
            color: white;
            border-color: var(--info-color);
        }

        .filter-button.all-items-btn:hover {
            background-color: #5a6268; /* Escurece no hover */
            border-color: #5a6268;
        }

        /* Footer */
        footer {
            text-align: center;
            padding: 1.5rem 1rem;
            margin-top: 2rem;
            background-color: var(--primary-color);
            color: white;
            font-size: 0.9rem;
        }

        .footer-content {
            display: flex;
            flex-direction: column;
            justify-content: center;
            align-items: center;
            gap: 5px;
        }

        .footer-text {
            margin: 0;
            font-style: italic;
        }

        .aura-text {
            /* Pode ser usado para dar uma cor diferente se quiser, mas por enquanto, manter√° a cor do texto pai */
        }

        .footer-logo {
            height: 50px;
            width: auto;
            object-fit: contain;
        }

        /* NOVO: Estilos para o Modal de Notifica√ß√£o / Toast */
        .app-notification {
            position: fixed;
            bottom: 20px; /* Posi√ß√£o na parte inferior */
            left: 50%;
            transform: translateX(-50%);
            background-color: var(--primary-color);
            color: white;
            padding: 15px 25px;
            border-radius: 8px;
            box-shadow: 0 4px 15px rgba(0, 0, 0, 0.2);
            z-index: 2000; /* Acima de tudo */
            display: flex;
            align-items: center;
            gap: 15px;
            opacity: 0; /* Come√ßa invis√≠vel */
            transition: opacity 0.5s ease-in-out, transform 0.5s ease-in-out;
            min-width: 250px;
            max-width: 90%; /* Limita a largura em telas menores */
        }

        .app-notification.show {
            opacity: 1;
            transform: translateX(-50%) translateY(-10px); /* Leve movimento para cima */
        }

        .app-notification.hidden {
            display: none; /* Mant√©m oculto com display none quando n√£o est√° vis√≠vel */
        }

        .app-notification p {
            margin: 0;
            flex-grow: 1;
        }

        .app-notification .close-notification-btn {
            background: none;
            border: none;
            color: white;
            font-size: 1.5rem;
            cursor: pointer;
            padding: 0;
            line-height: 1;
        }

        .app-notification.success {
            background-color: var(--success-color);
        }

        .app-notification.error {
            background-color: var(--danger-color);
        }

        .app-notification.info {
            background-color: var(--info-color);
        }


        /* Responsividade */
        @media (max-width: 768px) {
            body {
                padding-top: 120px; /* AJUSTADO: Ajuste para o cabe√ßalho em telas menores */
            }
            header {
                height: 120px; /* AJUSTADO: Altura do cabe√ßalho em telas menores */
            }
            header .header-content {
                flex-direction: row;
                justify-content: space-between;
                align-items: center;
                gap: 0;
            }
            .main-title-area {
                position: static;
                transform: none;
                flex-grow: 1;
                justify-content: center;
                gap: 5px;
            }
            header h1 {
                font-size: 1.8rem; /* Ajustado para mobile */
                text-align: center;
            }
            .header-main-logo {
                height: 50px; /* Ajustado para mobile */
            }
            .header-icons-right { /* Ajustado para mobile */
                position: static;
                transform: none;
                margin-left: auto;
                gap: 10px;
            }

            main {
                margin: 1rem auto;
                padding: 1rem;
            }

            .auth-container {
                padding: 1.5rem;
            }

            .dashboard-nav {
                flex-direction: column;
            }

            .dashboard-nav button {
                width: 100%;
            }

            .items-grid {
                grid-template-columns: 1fr;
            }

            .search-bar { /* MODIFICADO: Ajuste responsivo para search bar */
                flex-direction: column;
                align-items: center;
            }

            .filter-buttons { /* MODIFICADO: Ajuste responsivo para filter buttons */
                justify-content: center;
            }
        }

        @media (max-width: 480px) {
            h2 {
                font-size: 1.5rem;
            }

            button[type="submit"],
            .dashboard-nav button,
            .secondary-btn {
                padding: 0.7rem 1rem;
                font-size: 0.95rem;
            }

            .input-group input,
            .input-group textarea,
            .input-group select, /* NOVO: Estilo para o select de categoria */
            .search-bar input {
                padding: 0.7rem;
                font-size: 0.9rem;
            }
            .notification-badge {
                top: -5px;
                right: -5px;
                font-size: 0.7rem;
                padding: 1px 5px;
                min-width: 18px;
            }
            .filter-button { /* NOVO: Tamanho menor para bot√µes em telas muito pequenas */
                padding: 0.5rem 1rem;
                font-size: 0.85rem;
            }
        }
    </style>
</head>
<body>
    <header>
        <div class="header-content">
            <div class="main-title-area">
                <h1>Achados e Perdidos</h1>
                <img src="images/logo-etec.png" alt="Logo da ETEC" class="header-main-logo">
            </div>
            <div class="header-icons-right">
                <button id="approval-notification-btn" title="Notifica√ß√µes de Aprova√ß√£o" class="notification-icon-btn">
                    <i class="fas fa-check-circle"></i>
                    <span id="approval-notification-count" class="notification-badge hidden">0</span>
                </button>
                <button id="secretary-login-btn" title="Acesso da Secretaria" class="secretary-icon-btn">
                    <i class="fas fa-user-circle"></i>
                </button>
            </div>
        </div>
    </header>

    <main>
        <section id="student-view" class="active">
            <h2>Itens Encontrados na Escola</h2>
            <div class="search-bar">
                <input type="text" id="student-search-input" placeholder="Pesquisar por nome ou descri√ß√£o do item...">
                <div id="category-filter-buttons" class="filter-buttons">
                </div>
            </div>
            <div id="student-items-container" class="items-grid">
            </div>
            <p id="no-items-found" class="message hidden">Nenhum item encontrado com a sua pesquisa.</p>
        </section>

        <section id="auth-section" class="hidden">
            <div class="auth-container">
                <h2>Acesso da Secretaria</h2>
                <div class="auth-toggle">
                    <button id="show-login" class="active">Login</button>
                    <button id="show-register">Cadastro</button>
                </div>

                <form id="login-form" class="auth-form active">
                    <div class="input-group">
                        <label for="login-email">E-mail:</label>
                        <input type="email" id="login-email" required>
                    </div>
                    <div class="input-group">
                        <label for="login-password">Senha:</label>
                        <input type="password" id="login-password" minlength="8" required>
                    </div>
                    <button type="submit">Entrar</button>
                    <p id="login-message" class="message"></p>
                </form>

                <form id="register-form" class="auth-form">
                    <div class="input-group">
                        <label for="register-email">E-mail:</label>
                        <input type="email" id="register-email" required>
                    </div>
                    <div class="input-group">
                        <label for="register-password">Senha:</label>
                        <input type="password" id="register-password" minlength="8" required>
                    </div>
                    <div class="input-group">
                        <label for="register-confirm-password">Confirmar Senha:</label>
                        <input type="password" id="register-confirm-password" minlength="8" required>
                    </div>
                    <button type="submit">Cadastrar</button>
                    <p id="register-message" class="message"></p>
                </form>
                    <button type="button" id="back-to-student-from-auth" class="secondary-btn">Voltar para Itens</button>
            </div>
        </section>

        <section id="secretary-dashboard" class="hidden">
            <nav class="dashboard-nav">
                <button id="view-items-btn">Ver Itens Cadastrados</button>
                <button id="add-item-btn">Cadastrar Novo Item</button>
                <button id="view-proofs-btn">
                    Ver Comprova√ß√µes <span id="proof-notification-count" class="notification-badge hidden">0</span>
                </button>
                <button id="logout-btn" class="logout">Sair</button>
            </nav>

            <div id="item-list-view" class="dashboard-content active-content">
                <h2>Itens Cadastrados</h2>
                <div id="items-container" class="items-grid">
                </div>
                <p id="no-secretary-items-message" class="message hidden info">Nenhum item cadastrado ainda pela secretaria.</p>
            </div>

            <div id="add-item-view" class="dashboard-content">
                <h2>Cadastrar Novo Item</h2>
                <form id="add-item-form">
                    <div class="input-group">
                        <label for="item-name">Nome do Item:</label>
                        <input type="text" id="item-name" required>
                    </div>
                    <div class="input-group">
                        <label for="item-description">Descri√ß√£o:</label>
                        <textarea id="item-description" rows="4" required></textarea>
                    </div>
                    <div class="input-group">
                        <label for="item-location">Local Onde Foi Encontrado:</label>
                        <input type="text" id="item-location" required>
                    </div>
                    <div class="input-group">
                        <label for="item-category">Categoria:</label>
                        <select id="item-category" required>
                            <option value="">Selecione uma categoria</option>
                            </select>
                        <input type="text" id="item-custom-category" placeholder="Nome da nova categoria" class="hidden" style="margin-top: 10px;">
                    </div>

                    <div class="input-group">
                        <label for="item-photo">Foto do Item:</label>
                        <input type="file" id="item-photo" accept="image/*" capture="environment">
                        <img id="item-photo-preview" src="#" alt="Pr√©-visualiza√ß√£o da Foto" class="photo-preview hidden">
                        <p class="input-hint">Use a c√¢mera ou selecione uma imagem.</p>
                    </div>
                    <button type="submit">Adicionar Item</button>
                    <p id="add-item-message" class="message"></p>
                </form>
            </div>

            <div id="proofs-list-view" class="dashboard-content">
                <h2>Comprova√ß√µes Pendentes</h2>
                <div id="proofs-container" class="items-grid">
                </div>
                <p id="no-proofs-message" class="message hidden info">Nenhuma comprova√ß√£o pendente no momento.</p>
            </div>

        </section>

        <section id="questionnaire-section" class="hidden">
            <h2>Comprovar Posse do Item</h2>
            <p class="section-description">Preencha as informa√ß√µes abaixo para nos ajudar a verificar se o item pertence a voc√™.</p>
            <form id="proof-form">
                <div class="input-group">
                    <label for="student-name">Seu Nome Completo:</label>
                    <input type="text" id="student-name" required>
                </div>
                <div class="input-group">
                    <label for="student-class">Sua Turma:</label>
                    <input type="text" id="student-class" required>
                </div>
                <div class="input-group">
                    <label for="time-lost">üìÖ Qual a data ou hor√°rio aproximado que voc√™ perdeu o item?</label>
                    <input type="datetime-local" id="time-lost" required>
                </div>
                    <div class="input-group">
                    <label for="lost-location">Onde voc√™ acha que perdeu o item?</label>
                    <input type="text" id="lost-location" placeholder="Ex: P√°tio, Sala 5, Quadra" required>
                </div>
                <div class="input-group">
                    <label for="item-unique-detail">Descreva um detalhe espec√≠fico do item que N√ÉO est√° vis√≠vel na foto:</label>
                    <textarea id="item-unique-detail" rows="3" placeholder="Ex: Possui um pequeno arranh√£o na lateral, tem um adesivo de estrela atr√°s, cor do forro interno." required></textarea>
                </div>
                <button type="submit">Enviar Comprova√ß√£o</button>
                <p id="proof-message" class="message"></p>
                <button type="button" id="back-to-student-view" class="secondary-btn">Volta para Itens</button>
            </form>
        </section>
    </main>

    <div id="app-notification" class="app-notification hidden">
        <p id="notification-text"></p>
        <button class="close-notification-btn">&times;</button>
    </div>

    <footer>
        <div class="footer-content">
            <p class="footer-text">Desenvolvido com <span style="color: #e25555;">&hearts;</span> por <span class="aura-text">Projeto Aura</span></p>
            <p class="footer-text">¬© 2024 ETEC Dacy - Todos os direitos reservados.</p>
        </div>
    </footer>

    <script>
        // Fun√ß√µes auxiliares para manipula√ß√£o do DOM e exibi√ß√£o de se√ß√µes
        function showSection(sectionId) {
            document.querySelectorAll('section').forEach(section => {
                section.classList.remove('active');
                section.classList.add('hidden');
            });
            document.getElementById(sectionId).classList.remove('hidden');
            document.getElementById(sectionId).classList.add('active');
            window.scrollTo(0, 0); // Volta para o topo da p√°gina ao mudar de se√ß√£o
        }

        // NOVO: Fun√ß√£o auxiliar para formatar datas (RESOLVE "INVALID DATE")
        function formatDateTime(dateTimeString) {
            if (!dateTimeString) return 'Data/Hora n√£o informada';
            const date = new Date(dateTimeString);

            // Verifica se a data √© v√°lida
            if (isNaN(date.getTime())) {
                // Tenta um parser manual para datetime-local se o direto falhar,
                // que pode ocorrer se o fuso hor√°rio ou formato n√£o for estritamente ISO
                const [datePart, timePart] = dateTimeString.split('T');
                if (!datePart || !timePart) return 'Data/Hora Inv√°lida'; // Adiciona verifica√ß√£o para partes
                const [year, month, day] = datePart.split('-').map(Number);
                const [hours, minutes] = timePart.split(':').map(Number);
                // M√™s √© 0-indexed no construtor de Date
                const validDate = new Date(year, month - 1, day, hours, minutes);
                if (isNaN(validDate.getTime())) {
                    return 'Data/Hora Inv√°lida';
                }
                return validDate.toLocaleString('pt-BR', {
                    year: 'numeric',
                    month: '2-digit',
                    day: '2-digit',
                    hour: '2-digit',
                    minute: '2-digit'
                });
            }
            return date.toLocaleString('pt-BR', {
                year: 'numeric',
                month: '2-digit',
                day: '2-digit',
                hour: '2-digit',
                minute: '2-digit'
            });
        }


        // NOVO: Fun√ß√£o para mostrar notifica√ß√µes customizadas (SUBSTITUI ALERTS)
        const appNotification = document.getElementById('app-notification');
        const notificationText = document.getElementById('notification-text');
        const closeNotificationBtn = appNotification.querySelector('.close-notification-btn');

        let notificationTimeout;

        function showNotification(message, type = 'info', duration = 3000) {
            clearTimeout(notificationTimeout); // Limpa qualquer timeout anterior
            notificationText.textContent = message;
            appNotification.className = `app-notification show ${type}`; // Adiciona tipo e mostra
            appNotification.style.display = 'flex'; // Garante que esteja vis√≠vel (override hidden class)

            notificationTimeout = setTimeout(() => {
                appNotification.classList.remove('show');
                // Espera a transi√ß√£o terminar antes de ocultar completamente
                setTimeout(() => {
                    appNotification.classList.add('hidden');
                    appNotification.style.display = 'none'; // Oculta com display none
                }, 500); // Dura√ß√£o da transi√ß√£o CSS
            }, duration);

            closeNotificationBtn.onclick = () => {
                clearTimeout(notificationTimeout);
                appNotification.classList.remove('show');
                setTimeout(() => {
                    appNotification.classList.add('hidden');
                    appNotification.style.display = 'none';
                }, 500);
            };
        }


        // Mock de dados para simular backend (LocalStorage)
        // Adicionando um usu√°rio padr√£o para facilitar o teste da secretaria
        let users = JSON.parse(localStorage.getItem('secretaryUsers')) || [
            { email: 'secretaria@etec.com', password: 'etecpassword' } // Usu√°rio padr√£o para teste
        ];
        // Salvando o usu√°rio padr√£o se ele n√£o existir
        if (!JSON.parse(localStorage.getItem('secretaryUsers'))) {
             localStorage.setItem('secretaryUsers', JSON.stringify(users));
        }


        let items = JSON.parse(localStorage.getItem('lostAndFoundItems')) || [];
        let proofs = JSON.parse(localStorage.getItem('itemProofs')) || [];
        let categories = JSON.parse(localStorage.getItem('itemCategories')) || ["Material Escolar", "Eletr√¥nicos", "Roupas", "Documentos", "Outros"];


        // Vari√°veis de estado
        let loggedInUser = null;
        let selectedItemForProof = null; // Para guardar o item que o aluno est√° tentando comprovar

        // Refer√™ncias DOM
        const secretaryLoginBtn = document.getElementById('secretary-login-btn');
        const backToStudentViewBtn = document.getElementById('back-to-student-view');
        const backToStudentFromAuthBtn = document.getElementById('back-to-student-from-auth');

        // Autentica√ß√£o
        const showLoginBtn = document.getElementById('show-login');
        const showRegisterBtn = document.getElementById('show-register');
        const loginForm = document.getElementById('login-form');
        const registerForm = document.getElementById('register-form');
        const loginMessage = document.getElementById('login-message');
        const registerMessage = document.getElementById('register-message');

        // Dashboard da Secretaria
        const viewItemsBtn = document.getElementById('view-items-btn');
        const addItemBtn = document.getElementById('add-item-btn');
        const viewProofsBtn = document.getElementById('view-proofs-btn');
        const logoutBtn = document.getElementById('logout-btn');

        const itemsContainer = document.getElementById('items-container');
        const proofsContainer = document.getElementById('proofs-container');
        const addItemForm = document.getElementById('add-item-form');
        const itemPhotoInput = document.getElementById('item-photo');
        const itemPhotoPreview = document.getElementById('item-photo-preview');
        const addItemMessage = document.getElementById('add-item-message');
        const proofNotificationCount = document.getElementById('proof-notification-count');
        const approvalNotificationCount = document.getElementById('approval-notification-count');
        const approvalNotificationBtn = document.getElementById('approval-notification-btn');
        const noProofsMessage = document.getElementById('no-proofs-message');
        const noSecretaryItemsMessage = document.getElementById('no-secretary-items-message');

        // Formul√°rio de Adicionar Item
        const itemCategorySelect = document.getElementById('item-category');
        const itemCustomCategoryInput = document.getElementById('item-custom-category');


        // Visualiza√ß√£o do Aluno
        const studentItemsContainer = document.getElementById('student-items-container');
        const studentSearchInput = document.getElementById('student-search-input');
        const noItemsFoundMessage = document.getElementById('no-items-found');
        const categoryFilterButtonsContainer = document.getElementById('category-filter-buttons');


        // Event Listeners Globais
        secretaryLoginBtn.addEventListener('click', () => showSection('auth-section'));
        backToStudentViewBtn.addEventListener('click', () => showSection('student-view'));
        backToStudentFromAuthBtn.addEventListener('click', () => showSection('student-view'));


        // --- Fun√ß√µes de Autentica√ß√£o e Navega√ß√£o do Dashboard ---
        showLoginBtn.addEventListener('click', () => {
            showLoginBtn.classList.add('active');
            showRegisterBtn.classList.remove('active');
            loginForm.classList.add('active');
            registerForm.classList.remove('active');
            loginMessage.textContent = '';
        });

        showRegisterBtn.addEventListener('click', () => {
            showRegisterBtn.classList.add('active');
            showLoginBtn.classList.remove('active');
            registerForm.classList.add('active');
            loginForm.classList.remove('active');
            registerMessage.textContent = '';
        });

        loginForm.addEventListener('submit', (e) => {
            e.preventDefault();
            const email = document.getElementById('login-email').value;
            const password = document.getElementById('login-password').value;

            const user = users.find(u => u.email === email && u.password === password);

            if (user) {
                loggedInUser = user;
                showNotification('Login bem-sucedido!', 'success'); // SUBSTITUI ALERT
                showSection('secretary-dashboard');
                renderDashboardItems(); // Exibe os itens ao logar
                updateProofNotificationCount();
                updateApprovalNotificationBadge();
            } else {
                showNotification('Credenciais inv√°lidas.', 'error'); // SUBSTITUI ALERT
            }
        });

        registerForm.addEventListener('submit', (e) => {
            e.preventDefault();
            const email = document.getElementById('register-email').value;
            const password = document.getElementById('register-password').value;
            const confirmPassword = document.getElementById('register-confirm-password').value;

            if (password !== confirmPassword) {
                showNotification('As senhas n√£o coincidem.', 'error'); // SUBSTITUI ALERT
                return;
            }
            if (users.some(u => u.email === email)) {
                showNotification('Este e-mail j√° est√° cadastrado.', 'error'); // SUBSTITUI ALERT
                return;
            }

            users.push({ email, password });
            localStorage.setItem('secretaryUsers', JSON.stringify(users));
            showNotification('Cadastro realizado com sucesso! Fa√ßa login.', 'success'); // SUBSTITUI ALERT
            showLoginBtn.click(); // Volta para a tela de login
        });

        logoutBtn.addEventListener('click', () => {
            loggedInUser = null;
            showNotification('Logout realizado.', 'info'); // SUBSTITUI ALERT
            showSection('student-view'); // Volta para a tela do aluno
            renderStudentItems(); // Re-renderiza os itens para o aluno
            // Limpa os campos de login/cadastro
            loginForm.reset();
            registerForm.reset();
            itemPhotoPreview.classList.add('hidden'); // Oculta a preview da foto ao deslogar
            itemPhotoInput.value = ''; // Limpa o input de arquivo
        });

        // --- Fun√ß√µes do Dashboard da Secretaria ---
        viewItemsBtn.addEventListener('click', () => {
            document.querySelectorAll('.dashboard-content').forEach(content => content.classList.remove('active-content'));
            document.getElementById('item-list-view').classList.add('active-content');
            renderDashboardItems();
        });

        addItemBtn.addEventListener('click', () => {
            document.querySelectorAll('.dashboard-content').forEach(content => content.classList.remove('active-content'));
            document.getElementById('add-item-view').classList.add('active-content');
            addItemForm.reset(); // Limpa o formul√°rio ao abrir
            itemPhotoPreview.src = '#'; // Garante que a src esteja vazia
            itemPhotoPreview.classList.add('hidden'); // Oculta a preview
            itemPhotoInput.value = ''; // Limpa o input de arquivo
            renderCategoryOptions(); // Garante que as categorias estejam atualizadas
            itemCustomCategoryInput.classList.add('hidden'); // Oculta campo de categoria customizada
        });

        viewProofsBtn.addEventListener('click', () => {
            document.querySelectorAll('.dashboard-content').forEach(content => content.classList.remove('active-content'));
            document.getElementById('proofs-list-view').classList.add('active-content');
            renderProofs();
        });

        // L√≥gica para adicionar nova categoria
        itemCategorySelect.addEventListener('change', () => {
            if (itemCategorySelect.value === 'new-category') {
                itemCustomCategoryInput.classList.remove('hidden');
                itemCustomCategoryInput.setAttribute('required', 'required');
            } else {
                itemCustomCategoryInput.classList.add('hidden');
                itemCustomCategoryInput.removeAttribute('required');
            }
        });

        function renderCategoryOptions() {
            itemCategorySelect.innerHTML = '<option value="">Selecione uma categoria</option>';
            categories.forEach(category => {
                const option = document.createElement('option');
                option.value = category;
                option.textContent = category;
                itemCategorySelect.appendChild(option);
            });
            const newCategoryOption = document.createElement('option');
            newCategoryOption.value = 'new-category';
            newCategoryOption.textContent = 'Adicionar Nova Categoria';
            itemCategorySelect.appendChild(newCategoryOption);
            localStorage.setItem('itemCategories', JSON.stringify(categories));
        }


        // Pr√©-visualiza√ß√£o da imagem no formul√°rio de adicionar item
        itemPhotoInput.addEventListener('change', (event) => {
            const file = event.target.files[0];
            if (file) {
                const reader = new FileReader();
                reader.onload = (e) => {
                    itemPhotoPreview.src = e.target.result;
                    itemPhotoPreview.classList.remove('hidden');
                };
                reader.readAsDataURL(file);
            } else {
                itemPhotoPreview.src = '#';
                itemPhotoPreview.classList.add('hidden');
            }
        });

        addItemForm.addEventListener('submit', (e) => {
            e.preventDefault();
            const name = document.getElementById('item-name').value;
            const description = document.getElementById('item-description').value;
            const location = document.getElementById('item-location').value;
            let category = itemCategorySelect.value;
            const photo = itemPhotoPreview.src === '#' ? '' : itemPhotoPreview.src; // Pega a base64 da imagem

            // Se for nova categoria, usa o valor do campo customizado
            if (category === 'new-category') {
                category = itemCustomCategoryInput.value.trim();
                if (category && !categories.includes(category)) {
                    categories.push(category);
                    renderCategoryOptions(); // Atualiza a lista de categorias
                } else if (!category) {
                    showNotification('Nome da nova categoria n√£o pode ser vazio.', 'error');
                    return;
                }
            }


            const newItem = {
                id: Date.now(), // ID √∫nico baseado no timestamp
                name,
                description,
                location,
                category,
                photo,
                foundDate: new Date().toISOString(), // Data de quando foi cadastrado/encontrado
                claimed: false,
                approvedProofId: null // ID da comprova√ß√£o aprovada, se houver
            };

            items.push(newItem);
            localStorage.setItem('lostAndFoundItems', JSON.stringify(items));
            showNotification('Item adicionado com sucesso!', 'success'); // SUBSTITUI ALERT
            addItemForm.reset();
            itemPhotoPreview.src = '#'; // Reseta a src
            itemPhotoPreview.classList.add('hidden');
            itemPhotoInput.value = '';
            renderStudentItems(); // Atualiza a lista para o aluno tamb√©m
            renderDashboardItems(); // Atualiza a lista para a secretaria
            renderCategoryFilterButtons(); // Atualiza bot√µes de filtro para novas categorias
        });

        function renderDashboardItems() {
            itemsContainer.innerHTML = '';
            if (items.length === 0) {
                noSecretaryItemsMessage.classList.remove('hidden');
                itemsContainer.classList.add('hidden'); // Esconde o grid se n√£o houver itens
                return;
            } else {
                noSecretaryItemsMessage.classList.add('hidden');
                itemsContainer.classList.remove('hidden'); // Mostra o grid
            }

            items.forEach(item => {
                const itemCard = document.createElement('div');
                itemCard.className = 'item-card';

                // Renderiza imagem ou placeholder de √≠cone
                const itemImageHtml = item.photo
                    ? `<img src="${item.photo}" alt="${item.name}">`
                    : `<div class="item-placeholder-icon"><i class="fas fa-box"></i></div>`; // √çcone gen√©rico

                itemCard.innerHTML = `
                    ${itemImageHtml}
                    <div class="item-card-content">
                        <h3>${item.name}</h3>
                        <p>${item.description}</p>
                        <p class="item-meta"><strong>Encontrado em:</strong> ${item.location}</p>
                        <p class="item-meta"><strong>Categoria:</strong> ${item.category}</p>
                        <p class="item-meta"><strong>Data Encontrado:</strong> ${formatDateTime(item.foundDate)}</p>
                        <p class="item-meta"><strong>Status:</strong> ${item.claimed ? 'Reivindicado' : 'Dispon√≠vel'}</p>
                        <div class="item-actions">
                            <button class="edit-btn" data-id="${item.id}">Editar</button>
                            <button class="delete-btn" data-id="${item.id}">Excluir</button>
                        </div>
                    </div>
                `;
                itemsContainer.appendChild(itemCard);
            });

            // Adicionar event listeners para bot√µes de editar/excluir (l√≥gica ainda n√£o implementada)
            itemsContainer.querySelectorAll('.edit-btn').forEach(button => {
                button.addEventListener('click', (e) => {
                    showNotification(`Funcionalidade de Editar item ${e.target.dataset.id} ainda n√£o implementada.`, 'info');
                });
            });
            itemsContainer.querySelectorAll('.delete-btn').forEach(button => {
                button.addEventListener('click', (e) => {
                    // Substitui√ß√£o de 'confirm' por notifica√ß√£o customizada com confirma√ß√£o
                    showNotification(`Deseja realmente excluir o item "${items.find(i => i.id == e.target.dataset.id)?.name || 'desconhecido'}"?`, 'info', 5000);
                    // Um modal de confirma√ß√£o real seria melhor aqui, mas para manter a funcionalidade:
                    if (confirm('Tem certeza que deseja excluir este item? Esta a√ß√£o √© irrevers√≠vel.')) {
                         deleteItem(e.target.dataset.id);
                         showNotification('Item exclu√≠do com sucesso!', 'success');
                    }
                });
            });
        }

        function deleteItem(itemId) {
            items = items.filter(item => item.id != itemId); // Usar != para ID string/number
            localStorage.setItem('lostAndFoundItems', JSON.stringify(items));
            renderDashboardItems();
            renderStudentItems(); // Atualiza tamb√©m a visualiza√ß√£o do aluno
        }


        function renderProofs() {
            proofsContainer.innerHTML = '';
            const pendingProofs = proofs.filter(p => !p.approved && !p.rejected);

            if (pendingProofs.length === 0) {
                noProofsMessage.classList.remove('hidden');
                proofsContainer.classList.add('hidden'); // Oculta o grid se n√£o houver comprova√ß√µes
                return;
            } else {
                noProofsMessage.classList.add('hidden');
                proofsContainer.classList.remove('hidden');
            }

            pendingProofs.forEach(proof => {
                const itemRelated = items.find(item => item.id == proof.itemId);
                const itemThumbnailHtml = itemRelated && itemRelated.photo
                    ? `<img src="${itemRelated.photo}" alt="${itemRelated.name}" class="proof-item-thumbnail">`
                    : `<div class="proof-item-placeholder-icon"><i class="fas fa-box"></i></div>`; // √çcone gen√©rico para item sem foto

                const proofCard = document.createElement('div');
                proofCard.className = 'proof-card';
                proofCard.innerHTML = `
                    ${itemThumbnailHtml}
                    <h3>Comprova√ß√£o para ${itemRelated ? itemRelated.name : 'Item Desconhecido'}</h3>
                    <p><strong>Aluno:</strong> ${proof.studentName}</p>
                    <p><strong>Turma:</strong> ${proof.studentClass}</p>
                    <p><strong>Data/Hora da Perda:</strong> ${formatDateTime(proof.timeLost)}</p>
                    <p><strong>Local da Perda:</strong> ${proof.lostLocation}</p>
                    <p><strong>Detalhe Espec√≠fico:</strong> ${proof.uniqueDetail}</p>
                    <div class="proof-actions">
                        <button class="approve-btn" data-id="${proof.id}">Aprovar e Notificar</button>
                        <button class="reject-btn" data-id="${proof.id}">Rejeitar</button>
                    </div>
                `;
                proofsContainer.appendChild(proofCard);
            });

            // Adicionar event listeners para bot√µes de aprovar/rejeitar
            proofsContainer.querySelectorAll('.approve-btn').forEach(button => {
                button.addEventListener('click', (e) => approveProof(e.target.dataset.id));
            });
            proofsContainer.querySelectorAll('.reject-btn').forEach(button => {
                button.addEventListener('click', (e) => rejectProof(e.target.dataset.id));
            });
        }

        function approveProof(proofId) {
            const proofIndex = proofs.findIndex(p => p.id == proofId);
            if (proofIndex > -1) {
                proofs[proofIndex].approved = true;
                proofs[proofIndex].approvalDate = new Date().toISOString();
                proofs[proofIndex].approvalCode = generateApprovalCode(); // Gera um c√≥digo de aprova√ß√£o
                localStorage.setItem('itemProofs', JSON.stringify(proofs));

                // Marcar o item como reivindicado
                const itemIndex = items.findIndex(item => item.id == proofs[proofIndex].itemId);
                if (itemIndex > -1) {
                    items[itemIndex].claimed = true;
                    items[itemIndex].approvedProofId = proofs[proofIndex].id;
                    localStorage.setItem('lostAndFoundItems', JSON.stringify(items));
                    showNotification(`Item '${items[itemIndex].name}' reivindicado com sucesso!`, 'success');
                    renderStudentItems(); // Atualiza a visualiza√ß√£o do aluno
                }

                showNotification(`Comprova√ß√£o aprovada! C√≥digo de retirada: ${proofs[proofIndex].approvalCode}`, 'success', 8000);
                updateProofNotificationCount();
                updateApprovalNotificationBadge();
                renderProofs(); // Re-renderiza as comprova√ß√µes pendentes
            }
        }

        function rejectProof(proofId) {
            const proofIndex = proofs.findIndex(p => p.id == proofId);
            if (proofIndex > -1) {
                proofs[proofIndex].rejected = true;
                localStorage.setItem('itemProofs', JSON.stringify(proofs));
                showNotification('Comprova√ß√£o rejeitada.', 'info');
                updateProofNotificationCount();
                renderProofs(); // Re-renderiza as comprova√ß√µes pendentes
            }
        }

        function generateApprovalCode() {
            return Math.random().toString(36).substring(2, 8).toUpperCase(); // Ex: A1B2C3
        }

        function updateProofNotificationCount() {
            const pending = proofs.filter(p => !p.approved && !p.rejected).length;
            if (pending > 0) {
                proofNotificationCount.textContent = pending;
                proofNotificationCount.classList.remove('hidden');
            } else {
                proofNotificationCount.classList.add('hidden');
            }
        }

        function updateApprovalNotificationBadge() {
            const approvedProofs = proofs.filter(p => p.approved && !p.viewedByStudent);
            if (approvedProofs.length > 0) {
                approvalNotificationCount.textContent = approvedProofs.length;
                approvalNotificationCount.classList.remove('hidden');
            } else {
                approvalNotificationCount.classList.add('hidden');
            }
        }

        // Simula√ß√£o de notifica√ß√£o de aprova√ß√£o para o aluno (ao clicar no √≠cone)
        approvalNotificationBtn.addEventListener('click', () => {
            const approvedProofsForStudent = proofs.filter(p => p.approved && !p.viewedByStudent);
            if (approvedProofsForStudent.length > 0) {
                let message = 'Seus itens aprovados para retirada:\n\n';
                approvedProofsForStudent.forEach(p => {
                    const item = items.find(i => i.id == p.itemId);
                    message += `Item: ${item ? item.name : 'Desconhecido'}\n`;
                    message += `Data de Retirada: ${formatDateTime(p.approvalDate)}\n`;
                    message += `C√≥digo de Retirada: ${p.approvalCode}\n\n`;
                    p.viewedByStudent = true; // Marca como visualizado
                });
                localStorage.setItem('itemProofs', JSON.stringify(proofs));
                showNotification(message, 'success', 10000); // dura√ß√£o maior
                updateApprovalNotificationBadge(); // Atualiza o badge
            } else {
                showNotification('Voc√™ n√£o possui notifica√ß√µes de aprova√ß√£o no momento.', 'info');
            }
        });


        // --- Fun√ß√µes da Visualiza√ß√£o do Aluno ---
        function renderStudentItems(searchTerm = '', filterCategory = 'Todos') {
            studentItemsContainer.innerHTML = '';
            const filteredItems = items.filter(item => {
                const matchesSearch = searchTerm === '' ||
                    item.name.toLowerCase().includes(searchTerm.toLowerCase()) ||
                    item.description.toLowerCase().includes(searchTerm.toLowerCase());
                const matchesCategory = filterCategory === 'Todos' || item.category === filterCategory;
                return matchesSearch && matchesCategory && !item.claimed; // Aluno v√™ apenas itens dispon√≠veis
            });

            if (filteredItems.length === 0) {
                noItemsFoundMessage.classList.remove('hidden');
            } else {
                noItemsFoundMessage.classList.add('hidden');
            }

            filteredItems.forEach(item => {
                const itemCard = document.createElement('div');
                itemCard.className = 'item-card';

                // Renderiza imagem ou placeholder de √≠cone
                const itemImageHtml = item.photo
                    ? `<img src="${item.photo}" alt="${item.name}">`
                    : `<div class="item-placeholder-icon"><i class="fas fa-box"></i></div>`; // √çcone gen√©rico

                itemCard.innerHTML = `
                    ${itemImageHtml}
                    <div class="item-card-content">
                        <h3>${item.name}</h3>
                        <p>${item.description}</p>
                        <p class="item-meta"><strong>Encontrado em:</strong> ${item.location}</p>
                        <p class="item-meta"><strong>Categoria:</strong> ${item.category}</p>
                        <p class="item-meta"><strong>Data Encontrado:</strong> ${formatDateTime(item.foundDate)}</p>
                        <button class="claim-btn" data-id="${item.id}">Comprovar Posse</button>
                    </div>
                `;
                studentItemsContainer.appendChild(itemCard);
            });

            studentItemsContainer.querySelectorAll('.claim-btn').forEach(button => {
                button.addEventListener('click', (e) => {
                    const itemId = e.target.dataset.id;
                    selectedItemForProof = items.find(item => item.id == itemId); // Salva o item
                    showSection('questionnaire-section');
                    document.getElementById('proof-form').reset(); // Limpa o formul√°rio de comprova√ß√£o
                    document.getElementById('proof-message').textContent = '';
                });
            });
        }

        // L√≥gica de busca para a visualiza√ß√£o do aluno
        studentSearchInput.addEventListener('input', (e) => {
            const searchTerm = e.target.value;
            const activeFilterButton = categoryFilterButtonsContainer.querySelector('.filter-button.active');
            const currentCategoryFilter = activeFilterButton ? activeFilterButton.dataset.category : 'Todos';
            renderStudentItems(searchTerm, currentCategoryFilter);
        });

        // Gera√ß√£o dos bot√µes de filtro de categoria
        function renderCategoryFilterButtons() {
            categoryFilterButtonsContainer.innerHTML = ''; // Limpa bot√µes existentes

            // Bot√£o "Todos"
            const allButton = document.createElement('button');
            allButton.className = 'filter-button all-items-btn active';
            allButton.textContent = 'Todos';
            allButton.dataset.category = 'Todos';
            allButton.addEventListener('click', (e) => {
                categoryFilterButtonsContainer.querySelectorAll('.filter-button').forEach(btn => btn.classList.remove('active'));
                e.target.classList.add('active');
                renderStudentItems(studentSearchInput.value, 'Todos');
            });
            categoryFilterButtonsContainer.appendChild(allButton);

            // Bot√µes de categorias din√¢micas
            categories.forEach(category => {
                const button = document.createElement('button');
                button.className = 'filter-button';
                button.textContent = category;
                button.dataset.category = category;
                button.addEventListener('click', (e) => {
                    categoryFilterButtonsContainer.querySelectorAll('.filter-button').forEach(btn => btn.classList.remove('active'));
                    e.target.classList.add('active');
                    renderStudentItems(studentSearchInput.value, category);
                });
                categoryFilterButtonsContainer.appendChild(button);
            });
        }


        // Formul√°rio de Comprova√ß√£o
        const proofForm = document.getElementById('proof-form');
        proofForm.addEventListener('submit', (e) => {
            e.preventDefault();
            if (!selectedItemForProof) {
                showNotification('Nenhum item selecionado para comprova√ß√£o.', 'error');
                return;
            }

            const studentName = document.getElementById('student-name').value;
            const studentClass = document.getElementById('student-class').value;
            const timeLost = document.getElementById('time-lost').value;
            const lostLocation = document.getElementById('lost-location').value;
            const uniqueDetail = document.getElementById('item-unique-detail').value;

            const newProof = {
                id: Date.now(),
                itemId: selectedItemForProof.id,
                studentName,
                studentClass,
                timeLost,
                lostLocation,
                uniqueDetail,
                approved: false,
                rejected: false,
                approvalDate: null,
                approvalCode: null,
                viewedByStudent: false // Para saber se o aluno j√° viu a notifica√ß√£o
            };

            proofs.push(newProof);
            localStorage.setItem('itemProofs', JSON.stringify(proofs));
            showNotification('Sua comprova√ß√£o foi enviada e aguarda aprova√ß√£o.', 'info');
            proofForm.reset();
            updateProofNotificationCount(); // Atualiza o badge da secretaria
            showSection('student-view'); // Volta para a tela do aluno
        });

        // Inicializa√ß√£o
        document.addEventListener('DOMContentLoaded', () => {
            renderStudentItems();
            renderCategoryOptions(); // Carrega as categorias no select
            renderCategoryFilterButtons(); // Carrega os bot√µes de filtro
            updateProofNotificationCount(); // Atualiza o contador de comprova√ß√µes pendentes
            updateApprovalNotificationBadge(); // Atualiza o contador de aprova√ß√µes para o aluno
        });
    </script>
</body>
</html>